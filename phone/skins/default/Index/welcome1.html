<include file="common/top" />
<!-- swiper -->
<link rel="stylesheet" href="__PUBLIC__/phone/common/css/swiper-3.3.1.min.css">
<!-- mycss -->
<link rel="stylesheet" href="__PUBLIC__/phone/css/welcome1.css">
<!--小团慢css-->
<link rel="stylesheet" href="__PUBLIC__/phone/css/slow-travel.css">
<style>
	.page .content {margin-bottom: 1.5rem;}
	.background-img-loading{background-image: url(__PUBLIC__/home/common/images/background-img-loading.gif);background-repeat: no-repeat;background-position: center center;z-index:100;}
	.hot-sale .background-img-loading{min-height:110px;}
	/*.destination .background-img-loading{min-height:240px;}*/
</style>
<include file="common/footer" />
<div class="page">
	<div class="content">
		<!-- 这里是页面内容区 -->
		<!-- slider -->
		<div class="module01">
			<div class="swiper-container" >
				<div class="swiper-wrapper">
					<for start="1" end="7" comparison="elt">
						<php>$img = $set['lunbo'.$i]; $url = $set['lunbo'.$i.'_url'];</php>
						<div class="swiper-slide"><a href="{$url}" external><img src="{$img}?imageMogr2/gravity/Center/crop/1000x" alt=""></a></div>
					</for>
				</div>
			</div>
		</div>
		<!-- slide 点点点-->
		<div class="swiper-pagination swiper-pagination-bullets"><span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span></div>
		<!-- 电话 -->
		<div class="telephone">
			<a href="tel:400-080-5860" external><img src="__PUBLIC__/phone/images/index/telephone.png" alt=""></a>
		</div>
		<!-- logo 搜索 -->
		<div class="logo-search">
			<div class="logo-search-content">
				<div class="searchbar">
					<img src="__PUBLIC__/phone/images/index/logo.png" alt="">
					<div class="search-input">
						<i class="iconfont">&#xe607;</i>
						<label class="icon icon-search" for="search"></label>
						<input type="search" id="search" value="{$station_id}" style="padding-left: 1.2rem;" placeholder="搜索产品...">

					</div>
					<script type="text/javascript">
                        $("#search").keydown(function(event){
                            if(event.which == 13){
                                $('#search').blur();
                            }
                        });

                        $('#search').blur(function(){
                            var search_val = $(this).val();
                            $.post('{:U("line/search")}', {searchval:search_val}, function(data){
                                if (data.jumpUrl != null) {
                                    location.href = data.jumpUrl;
                                }
                            });
                        });
					</script>
				</div>
			</div>
		</div>
		<!-- 顶部 -->
		<div class="top-div">
			<!-- 顶部分类 -->
			<div class="content-padded grid-demo">
				<div class="top-list">
					<div class="top-sublist">
						<a href="{:U('line/list')}/t/sd" external>
							<img src="__PUBLIC__/phone/images/index/2.png" alt="">
							<p>小团慢旅行</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="{:U('line/xiezhenlvxing')}" external>
							<img src="__PUBLIC__/phone/images/index/5.png" alt="">
							<p>跟拍游</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="{:U('line/list')}/t/sy" external>
							<img src="__PUBLIC__/phone/images/index/3.png" alt="">
							<p>摄影游</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="{:U('line/book')}" external>
							<img src="__PUBLIC__/phone/images/index/4.png" alt="">
							<p>定制游</p>
						</a>
					</div>
				</div>
				<!--<div class="top-list">
					<div class="top-sublist">
						<a href="{:U('line/list')}/t/zb" external>
							<img src="__PUBLIC__/phone/images/index/1.png" alt="">
							<p>周边游</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="javascript:;" external>
							<img src="__PUBLIC__/phone/images/index/6.png" alt="">
							<p>深度游</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="javascript:;" external>
							<img src="__PUBLIC__/phone/images/index/7.png" alt="">
							<p>摄影游</p>
						</a>
					</div>
					<div class="top-sublist">
						<a href="javascript:;" external>
							<img src="__PUBLIC__/phone/images/index/8.png" alt="">
							<p>出境游</p>
						</a>
					</div>
				</div>-->
			</div>
			<!-- end 顶部分类 -->
			<!-- 报名动态 -->
			<div class="swiper_wrap">
				<img src="__PUBLIC__/phone/images/index/baoming.png" alt="报名动态">
				<ul class="font_inner">
					<volist id="order" name="orders">
						<li><a href="{:U('line/info')}/id/{$order.lineid}">
							{$order.addtime_short_show}
							<span>{$order.mob_show}</span>
							{$order.title_short_show}
						</a></li>
					</volist>
				</ul>
			</div>
		</div>
		<!-- end 顶部 -->
		<!--小团慢-->
		<div class="slow-travel">
			<a href="{:U('subject/brand')}" external>
				<img src="__PUBLIC__/phone/images/index/xiaotuanman.jpg" alt="">
			</a>
		</div>
		<!-- 小专题 -->
		<!--<div class="special">
			<php>
				$titleColor = array('f60','75b168','41d3fd','f50c3d');
				$divStyle=array('border-right: 1px solid #dcdcdc;', '', 'border-right: 1px solid #dcdcdc;', '');
			</php>
			<for start="0" end="4" comperison="elt">
				<php>
					$rowClass = intval($i / 2) == 0 ? 'border-bottom: 1px solid #dcdcdc;' : '';
					$zt = $set['zhuanti'.$i];
				</php>
				<if condition="$i % 2 == 0">
					<div class="special-list" style="{$rowClass}">
				</if>
					<div class="special-sublist" style="{$divStyle[$i]}">
						<a href="{$zt.url}" external>
							<span style="color: #{$titleColor[$i]};">{$zt.title}</span>
							<p>{$zt.subheading}</p>
							<img src="{$zt.img_main}" alt="">
						</a>
					</div>
				<if condition="$i % 2 == 1">
					</div>
				</if>
			</for>
		</div>-->
		<!--超级目的地-->
		<div class="bournBoxTitle"><span>超级目的地</span></div>
		<div class="module02">
			<div class="swiper-container" style="padding-left:3%;padding-right:3%;">
				<div class="swiper-wrapper">
					<volist id='zt' name="set">
						<if condition="strpos($key,'zhuanti') heq 0">
							<div class="swiper-slide" style="position: relative;">
								<php>$url = str_replace('home','phone',$zt['url']);</php>
								<a href="{$url}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" external></a>
								<div><img src="{$zt.img_main}" alt=""></div>
								<p class="lg">{$zt.title}</p>
								<p class="sm">{$zt.subheading}</p>
							</div>
						</if>
					</volist>
				</div>
				<!-- Add Pagination -->
				<!--<div class="swiper-pagination"></div>-->
			</div>
		</div>
		<!-- end 小专题 -->

		<!-- 精选热卖 -->
		<div class="bournBoxTitle bournBoxTitle-remai"><span>精选热卖</span></div>
		<div class="hot-sale">
			<div class="recommend-result">
				<for start="0" end="10">
					<php> $hotLine = $set['hot_line_recommend'.$i];</php>
					<if condition="empty($hotLine) eq false">
						<div class="item">
							<span class="img-width"><img class="img-responsive background-img-loading" data-echo="{$hotLine['img1']}" alt=""></span>
							<div class="detail">
								<p class="lg">{$hotLine['title']}</p>
								<p class="sm">{$hotLine['subheading']}</p>
							</div>
							<div class="price">
								<php>
									if (empty($hotLine['check_price'])) {
									echo('<span class="right"><span class="money">未审核</span></span>');
									}else {
									$price = explode('.', $hotLine['start_price_adult']);
									echo('<span class="right">￥<span class="money">'.$price[0].'</span>元起</span>');
									}
								</php>
							</div>
							<a href="{:U('line/info')}/id/{$hotLine['id']}" external></a>
						</div>
					</if>
				</for>
			</div>
		</div>
		<div class="bournBoxTitle"><span>目的地精选</span></div>
		<!--目的地选择-->
		<div id="j-bournBox">
			<div class="bournTopList" id="bournFixed">
				<div class="scrollBox" id="scrollBox">
					<ul class="bournList displayBox" id="j-bournTitle">
						<php>$themeMap = array('pc_home_menu_xtmlx'=>true, 'pc_home_menu_xinlvpai'=>true, 'pc_home_menu_sheying'=>true, 'pc_home_menu_zhuti'=>true);</php>
						<volist id="tm" name="menus" key="mk">
							<if condition="empty($themeMap[$tm['item_key']]) eq false">
								<if condition="$tm['item_key'] eq 'pc_home_menu_zhuti'">
									<li data-id="{$tm.id}" class="open-preloader">深度游</li>
									<else />
									<li data-id="{$tm.id}" class="open-preloader">{$tm.item_desc}</li>
								</if>
							</if>
						</volist>
					</ul>
				</div>
				<div class="bournChildList fn-clear" id="j-bournTitleChild">
					<!--<volist id="lm" name="left_menus">-->
					<!--<if condition="$lm['item_key'] eq 'pc_home_left_menu_hot'">-->
					<!--<ul style="display: none;" data-key="{$lm['item_key']}">								-->
					<!--<li class="hover" data-key="default">推荐</li>-->
					<!--<volist id="lmc" name="lm.child">						-->
					<!--<li data-id="{$lmc.id}">{$lmc.item_desc}</li>-->
					<!--</volist>-->
					<!--</ul>-->
					<!--</if>-->
					<!--</volist>-->

					<volist id="tm" name="menus">
						<if condition="empty($themeMap[$tm['item_key']]) eq false">
							<ul style="display: none;" data-key="{$tm['item_key']}">
								<li class="hover open-preloader" data-key="default">推荐</li>
								<volist id="tmc" name="tm.child">
									<li data-id="{$tmc.id}" class="open-preloader">{$tmc.item_desc}</li>
								</volist>
							</ul>
						</if>
					</volist>
				</div>
			</div>
		</div>
		<!--目的地线路-->
		<div class="item template_item hidden_ctrl">
			<img class="img-responsive background-img-loading" data-echo="" alt="">
			<div class="detail">
				<p class="lg line-title"><span class="span"></span><span class="sm subheading"></span></p>
			</div>
			<div class="price">
				<span class="place"></span>
				<span class="right">￥<span class="money"></span>元起</span>
			</div>
			<a href="javascript:;" external></a>
		</div>
		<div class="destination">
			<div class="recommend-result list_container list_active" data-index="0" data-more="1">
			</div>
		</div>
	</div>
</div>



<include file="common/js" />
<!-- swiper -->
<script src="__PUBLIC__/phone/common/js/swiper-3.3.1.min.js"></script>
<!--图片延时加载-->
<script src="__PUBLIC__/home/common/js/echo.min.js"></script>
<script>
    //初始化图片延迟加载
    echo.init({
        offset: 200,
        throttle: 0
    });
    //加载指示
    $(document).on('click','.open-preloader', function () {
        $.showPreloader();
        setTimeout(function () {
            $.hidePreloader();
        }, 2000);
    });
    $('#j-bournTitleChild').find('ul:first').css('display', 'block');

    //精选目的地
    $(".bournList li").on("click",function(){
        var index = $(this).index();
        $(this).addClass("active").siblings().removeClass("active");
        $(".bournChildList").find("ul").eq(index).show().siblings().hide();
        // 标签切换
        changeTab();
    })

    // 目的地框固定
    $(window).load(function() {
        var jheight = $("#j-bournBox").height() + 80;
        var startPos = $('#j-bournBox').offset().top - jheight;

        function fixedDestination() {
            //content滚动距离
            var p = $(".content").scrollTop();
            //当tabs距离顶部距离 <= content滚动距离时
            if( startPos <= p ){
                //固定tabs
                $('#j-bournBox').css({'position':'fixed',
                    'top':'0',
                    'left':'0',
                    'width':'100%',
                    'z-index':'999'});
                $(".destination").css("margin-top",jheight-80)
            }else{
                //清除固定
                $('#j-bournBox').css('position','static');
                $(".destination").css("margin-top","0px")
            }
        }

        // 滚动加载
        function scrollLoadData() {
            var b = $("document").scrollTop()+$(window).height();
            var t = $('.destination').offset().top;
            if (t <= b) {
                loadMoreData();
            }
        }

        //    固定目的地选择框
        window.onload = function() {
            //绑定滚动事件
            $(".content").on( "scroll", function() {
                // 目的地框固定
                fixedDestination();
                // 滚动加载
                scrollLoadData();
            });
        }

    })

    //地方选择
    $(".bournChildList ul li").on("click",function(){
        $(this).addClass("hover").siblings().removeClass("hover");
        // 标签切换
        changeTab();
    })
    //swiper
    $(function(){
        var swiper = new Swiper('.module01 .swiper-container', {
            pagination: '.swiper-pagination',
            slidesPerView: 1,
            paginationClickable: true,
            spaceBetween: 10,
            loop: true,
            centeredSlides: true,
            autoplay: 2500,
            autoplayDisableOnInteraction: false
        });
        var swiper = new Swiper('.module02 .swiper-container', {
            slidesPerView: 2.7,
            paginationClickable: true,
            spaceBetween: 20,
            freeMode: true
        });
    });

    //滚动文字
    $(function(){
        //1文字轮播(2-5页中间)开始
        $(".font_inner li:eq(0)").clone(true).appendTo($(".font_inner"));//克隆第一个放到最后(实现无缝滚动)
        var liHeight = $(".swiper_wrap").height();//一个li的高度
        //获取li的总高度再减去一个li的高度(再减一个Li是因为克隆了多出了一个Li的高度)
        var totalHeight = ($(".font_inner li").length *  $(".font_inner li").eq(0).height()) -liHeight;
        $(".font_inner").height(totalHeight);//给ul赋值高度
        var index = 0;
        var autoTimer = 0;//全局变量目的实现左右点击同步
        var clickEndFlag = true; //设置每张走完才能再点击
        function tab(){
            $(".font_inner").stop().animate({
                top: -index * liHeight
            },400,function(){
                clickEndFlag = true;//图片走完才会true
                if(index == $(".font_inner li").length -1) {
                    $(".font_inner").css({top:0});
                    index = 0;
                }
            })
        };
        function nextword() {
            index++;
            if(index > $(".font_inner li").length - 1) {
                //判断index为最后一个Li时index为0
                index = 0;
            }
            tab();
        };
        function prevword() {
            index--;
            if(index < 0) {
                index = $(".font_inner li").size() - 2;//因为index的0 == 第一个Li，减二是因为一开始就克隆了一个LI在尾部也就是多出了一个Li，减二也就是_index = Li的长度减二
                $(".font_inner").css("top",- ($(".font_inner li").size() -1) * liHeight);//当_index为-1时执行这条，也就是走到li的最后一个
            }
            tab();
        };
        //自动轮播
        autoTimer = setInterval(nextword,3000);
        $(".font_inner a").hover(function(){
            clearInterval(autoTimer);
        },function() {
            autoTimer = setInterval(nextword,3000);
        });
    });

    function changeTab() {

        // 清空所有内容
        $('.list_container').attr('data-index', 0);
        $('.list_container').attr('data-more', 1);
        $('.list_container').children().remove();
        $('.no-more-data').remove();

        // 加载更多
        loadMoreData();
    }

    // 获取条件
    function getConditions() {
        var cdsstr = '';
        var theme = $('#j-bournTitle').find('li.active');
        if ($(theme).length > 0 && $(theme).attr('data-key') != 'default') {
            cdsstr = 'theme_type|'+$(theme).html();
        }
        var dest = $('#j-bournTitleChild').find('ul:visible').find('li.hover');
        if ($(dest).length > 0 && $(dest).attr('data-key') != 'default') {
            if (cdsstr != '') {
                cdsstr += '|';
            }
            cdsstr = 'destination|'+$(dest).html();
        }
        return cdsstr;
    }

    // 查找产品
    var loading = false;	// 是否在加载中
    function loadMoreData() {
        var containerObj = $('.list_container');
        var noMoreData = $(containerObj).attr('data-more');
        if (noMoreData == '0' || loading == true) {
            return false;
        }
        var p = parseInt($(containerObj).attr('data-index'));
        var jsonData = {
            page: p,
        }

        var cdsstr = getConditions();
        if (cdsstr != '') {
            jsonData['cds'] = cdsstr;
        }

        console.log(JSON.stringify(jsonData));
        loading = true;
        $.post('{:U("line/list")}', jsonData, function(data){
            loading = false;
            if (data.result.errno == 0) {
                if (data.ds != null && data.ds != 'undefined') {
                    for (var i=0; i < data.ds.length; i++) {
                        var d = data.ds[i];
                        var itemObj = $('.template_item').clone(true);
                        $(itemObj).removeClass('template_item');
                        $(itemObj).removeClass('hidden_ctrl');
                        $(itemObj).find('.background-img-loading').attr('src', d.img1);
                        $(itemObj).find('p.line-title .span').html('【'+d.title+'】');
                        $(itemObj).find('.subheading').html(d.subheading);
                        $(itemObj).find('.place').html('出发地：'+d.assembly_point_show_text);
                        if (d.check_price == 0) {
                            $(itemObj).find('.price .right').html('未审核');
                        } else {
                            $(itemObj).find('.price .money').html(d.start_price_adult);
                        }
                        $(itemObj).find('a').attr('href', '{:U("line/info")}/id/'+d.id);
                        // 添加新条目
                        $(containerObj).append(itemObj);
                        $(containerObj).attr('data-index', p+1);
                    } // end for
                } else {
                    if ($(containerObj).parent().find('.no-more-data').length > 0) {
                        $(containerObj).find('.no-more-data').html('没有更多数据...');
                    } else {
                        var vhtml = '<div class="no-more-data">没有更多数据...</div>';
                        $(containerObj).parent().append(vhtml);
                    }
                    // 处理么有数据可加载情况
                    $(containerObj).attr('data-more', '0');
                }
            } else {
                console.log(data.result.message);
            }
        });
    }

    // 首次加载数据
    loadMoreData();

</script>
<include file="common/swt" />
</body>
</html>