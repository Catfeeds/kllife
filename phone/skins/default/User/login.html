<include file="common/top" />
	<!-- mycss -->
	<link rel="stylesheet" href="__PUBLIC__/phone/css/user_login.css">
	<include file="common/js" />
	<style>
.stage{position:relative;padding: 0 15px;height:55px;}
.slider{position:absolute; width: 200px; height:32px;box-shadow:0 0 3px #999;background-color:#ddd;left:6px;top:-17px;}
.slider-text {
    background: -webkit-gradient(linear, left top, right top, color-stop(0, #4d4d4d), color-stop(.4, #4d4d4d), color-stop(.5, white), color-stop(.6, #4d4d4d), color-stop(1, #4d4d4d));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    -webkit-animation: slidetounlock 3s infinite;
    -webkit-text-size-adjust: none;
    line-height: 32px;
    height: 32px;
    text-align: center;
    font-size: 16px;
    width: 200px;
    color: #aaa;
}
@keyframes slidetounlock
{
    0%     {background-position:-200px 0;}
    100%   {background-position:200px 0;}
}
@-webkit-keyframes slidetounlock
{
    0%     {background-position:-200px 0;}
    100%   {background-position:200px 0;}
}
.button-off{
    position: absolute;
    left: 0;
    top: 0;
    width: 32px;
    height: 32px;
    background-color: #fff;
    transition: left 0s;
    -webkit-transition: left 0s;
}
.button-on{
    position: absolute;
    left: 0;
    top: 0;
    width: 32px;
    height: 32px;
    background-color: #fff;
    transition: left 1s;
    -webkit-transition: left .5s;
}
.track{
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    overflow: hidden;
    transition: width 0s;
    -webkit-transition: width 0s;
    z-index: 10;
}
.track-on{
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    overflow: hidden;
    transition: width 1s;
    -webkit-transition: width .5s;
}
.icon-move  {
    width: 32px;
    height: 32px;
    position: relative;
    top:1px;
    left:0;
    font-family: sans-serif;
}
.icon-move:before{
    content:'>>';
    color:#ccc;
    line-height:32px;
}
.spinner {
    width: 20px;
    height: 20px;	
	background: url('__PUBLIC__/phone/images/order_create/code_ok.png') no-repeat;
    position: relative;
    top:6px;
    left:6px;
    background-size: 100% 100%;
    display: none;
}

@-webkit-keyframes bouncedelay {
    0%, 80%, 100% { -webkit-transform: scale(0.0) }
    40% { -webkit-transform: scale(1.0) }
}
@keyframes bouncedelay {
    0%, 80%, 100% {
        transform: scale(0.0);
        -webkit-transform: scale(0.0);
    } 40% {
          transform: scale(1.0);
          -webkit-transform: scale(1.0);
      }
}
.bg-green {
    line-height: 32px;
    height: 32px;
    text-align: center;
    font-size: 16px;
    background-color: #78c430;
}
</style>
	<div class="page page-current" id="router">
		<header class="bar bar-nav">
			<a class="button button-link button-nav pull-left back" href="#">
		      <i class="iconfont">&#xe606;</i>
		    </a>
		    <if condition="empty($duid)">
		    	<h1 class="title">领袖户外欢迎您</h1>
		    <else />
		    	<h1 class="title">{$fxset.shop_title.data.value}</h1>
		    </if>
		</header>
		<include file="common/footer" />
		<div class="content">
			<div class="login-header">
				<div class="login-header-img">
				    <if condition="empty($duid)">
						<img src="__PUBLIC__/phone/images/user_login/myhead.png" alt="">
				    <else />
						<img src="__PUBLIC__/phone/images/user_login/fxhead.jpg" alt="">
				    </if>
				</div>
				<div class="buttons-tab">
					<a href="#tab1" class="tab-link active button">帐号登录</a>
					<a href="#tab2" class="tab-link button">短信登录</a>
				</div>
				<div class="tabs">
					<div id="tab1" class="tab active">
						<p class="arrow-up"></p>
						<div class="list-block">
							<div class="item-content">
								<div class="item-inner">
									<div class="item-title label">登录账户</div>
									<div class="item-input">
							  			<input class="account" type="text" placeholder="用户名/手机/邮箱">
									</div>
								</div>
				            </div>
				            <div class="item-content">
				            	<div class="item-inner">
									<div class="item-title label">密码</div>
									<div class="item-input">
							  			<input class="password" type="password" placeholder="请输入您的密码">
									</div>
								</div>
				            </div>	
				        </div>
				        <a href="#routers-login-inner-2">忘记密码？</a>
						<div class="login-btn">
							<a href="javascript:;" external>登录</a>
						</div>
						<div class="register-btn">
							<a href="#routers-login-inner-1">还没有账号？立即注册</a>
						</div>
						<div class="help-center" >
							<a style="display: block; width: 90%; height: 2.2rem; line-height: 2.2rem; margin: 0 auto; margin-top: .5rem; background-color: #fff; border: 1px solid #ff7200; color: #ff7200; font-size: .9rem;" href="{:U('service/center')}" external>帮助中心</a>
						</div>
						
						<div class="third-party">
							<div class="third-party-header">
								<p></p>
								<h6>使用第三方登录</h6>
							</div>
							<div class="third-party-btn">
								<a href="{:U('thirdLogin/login')}/type/qq/" target="_blank" external><img src="__PUBLIC__/phone/images/user_login/qq.png" alt=""></a>
								<a href="http://kllife.com/weixin/" target="_blank" external class="wx-login-bot"><img src="__PUBLIC__/phone/images/user_login/wx.png" alt=""></a>
							</div>
						</div>
						
					</div>
					<div id="tab2" class="tab">
						<p class="arrow-up"></p>
						<div class="list-block">
							<div class="item-content">
								<div class="item-inner">
									<div class="item-title label">手机号</div>
									<div class="item-input">
							  			<input class="phone" type="number" maxlength="11" placeholder="请输入您的手机号">
									</div>
								</div>
				            </div>
				            <!--<div class="item-content">
								<div class="item-inner">
									<div class="item-title label">验证码</div>
									<div class="item-input" style="position: relative;">
										<input class="phone t-code" type="text" maxlength="11" placeholder="请输入验证码">
										<img id="yanzhengma-img" style="position: absolute;top:0px;right:-.6rem;height:40px;width:97px;" alt="">
									</div>
								</div>
				            </div>-->
				            <div class="item-content">
				            	<div class="item-inner">
									<div class="item-title label">校验码</div>
									<div class="item-input">
							  			<input class="verify_code" type="text" maxlength="6" >
							  			<input class="msg-send-code get-code" type="button" value="获取校验码" readonly="">
									</div>
								</div>
				            </div>	

				            <div class="login-btn">
								<a href="javascript:;" external>登录</a>
							</div>

				        </div>
					</div>
			    </div>

			</div>
		</div>
	</div>

	<script src="__PUBLIC__/common/js/verify.js" > </script>
	<script type="text/javascript">
		var verifyCode = null;
		$(document).ready(function(){
			// 初始化验证码
//			verifyCode = new Verify($('#yanzhengma-img'),130,40,4,18);

			if(!isWeiXin()){
				$('.wx-login-bot').css('display', 'none');
			}
		});
		// 获取效验码
		var InterValObj2; //timer变量，控制时间
		var count2 = 600; //间隔函数，1秒执行
		var curCount2 = 600;//当前剩余秒数
		$('#tab2').find('.msg-send-code').click( function () {
//            var code = $('.t-code').val();
//            if(verifyCode.check(code) == false){
//                alert("验证码不正确，请重新输入");
//				return false;
//			}else{
//                verifyCode.refresh();
                if(curCount2 < count2){
                    return false;
                }else{
                    var jsonData = {
                        type: 'send',
                        tel: $('#tab2').find('.phone').val(),
                        use: 'phone_sms_login',
                        interval: 600,
                        rd: '{$pagerd}',
                    }
                    $.post('{:U("common/sms")}', jsonData, function(data){
                        if (data.result.errno == 0) {
                            sendMessage2();
                        } else {
                            alert(data.result.message);
                        }
                    });
                }
//			}

		} );
		
		//获取效验码		
		function sendMessage2() {
			curCount2 = count2;
		　　//设置button效果，开始计时
			var sendBtnObj = $('#tab2').find('.msg-send-code');
			$(sendBtnObj).attr("disabled", "true");
			$(sendBtnObj).val(curCount2 + "秒内输入");
			InterValObj2 = setInterval(SetRemainTime2, 1000); //启动计时器，1秒执行一次
		}
		
		//timer处理函数
		function SetRemainTime2() {
			if (curCount2 == 0) {          
				clearInterval(InterValObj2);//停止计时器
				$('#tab2').find(".msg-send-code").removeAttr("disabled");//启用按钮
				$('#tab2').find(".msg-send-code").val("重新发送");
				curCount2 = 600;
			} else {
				curCount2--;
				$('#tab2').find(".msg-send-code").attr("disabled", "true");
				$('#tab2').find(".msg-send-code").val(curCount2 + "秒内输入");
			}
		}
		
		$("#router").find(".login-btn").click(function(){
			var tab = $('.buttons-tab').find('a.active').attr('href');
			if (tab == '#tab1') {
				var jsonData = {
					account: $(tab).find('.account').val(),
					password: $(tab).find('.password').val(),
				};
				if ('{$duid}' != '') {
					jsonData['duid'] = '{$duid}';
				}
				$.post('{:U("user/login")}', jsonData, function(data){
					if (data.result.errno == 0) {
						//登录成功后返回之前的页面
						var jumpUrl = document.referrer;
						if( jumpUrl.indexOf('/user/login') != -1 ||
							jumpUrl.indexOf('/user/forgotpassword') != -1 || 
							jumpUrl.indexOf('/user/register') != -1 || 
							jumpUrl.indexOf('/user/smslogin') != -1 ){
							jumpUrl = 'http://kllife.com/phone';
						}						
						if ('{$duid}' != '') {
							jumpUrl = '{:U("fenxiao/welcome")}/duid/{$duid}';
						}
						
						// 登录社区
						if (data.user != null && data.user != 'undefined') {
							loginShequ(data.user, jumpUrl, 1);
						}
//						location.href = jumpUrl;
					} else {
						alert(data.result.message);
					}
				});
				$(this).find("a").attr('disabled',"true").addClass('disabled');
			} else {
				var sphone = $(tab).find('.phone').val();
				if (checkMobile(sphone) == false) {
					alert('错误的电话号码');
					return false;
				}

				var scode = $(tab).find('.verify_code').val();
				if (scode.length != 6) {
					alert('验证码有误');
					return false;
				}
				
				var jsonData = {
					phone: sphone, 
					code: scode
				}
				if ('{$duid}' != '') {
					jsonData['duid'] = '{$duid}';
				}
				
				$.post('{:U("user/smslogin")}', jsonData, function(data){
					if (data.result.errno == 0) {
						//登录成功后返回之前的页面
						var jumpUrl = document.referrer;
						if( jumpUrl.indexOf('/user/login') != -1 ||
							jumpUrl.indexOf('/user/forgotpassword') != -1 || 
							jumpUrl.indexOf('/user/register') != -1 || 
							jumpUrl.indexOf('/user/smslogin') != -1 ){
							jumpUrl = 'http://kllife.com/phone';
						}						
						if ('{$duid}' != '') {
							jumpUrl = '{:U("fenxiao/welcome")}/duid/{$duid}';
						}						
						// 登录社区
						if (data.user != null && data.user != 'undefined') {
							loginShequ(data.user, jumpUrl, 1);
						}
//						location.href = data.jumpUrl;
					} else {
						alert(data.result.message);
					}
				});
				$(this).find("a").attr('disabled',"true").addClass('disabled');
			}
		});
		
		//判断是否微信浏览器打开
		function isWeiXin(){
			var ua = window.navigator.userAgent.toLowerCase();
			if(ua.match(/MicroMessenger/i) == 'micromessenger'){
				return true;
			}else{
				return false;
			}
		}
	</script>

	<div class="page" id="routers-login-inner-1">
		<header class="bar bar-nav">
			<a class="button button-link button-nav pull-left back" href="#">
		      <i class="iconfont">&#xe606;</i>
		    </a>
		    <if condition="empty($duid)">
		    	<h1 class="title">领袖户外欢迎您</h1>
		    <else />
		    	<h1 class="title">{$fxset.shop_title.data.value}</h1>
		    </if>
		</header>
		<include file="common/footer" />
		<div class="content">
			<div class="register-header">
				<div class="register-header-img">
				    <if condition="empty($duid)">
						<img src="__PUBLIC__/phone/images/user_login/myhead.png" alt="">
				    <else />
						<img src="__PUBLIC__/phone/images/user_login/fxhead.jpg" alt="">
				    </if>
					<p>立即注册</p>
				</div>
				<div class="register-content">
					<div class="list-block">
						<div class="item-content">
							<div class="item-inner">
								<div class="item-title label">手机号</div>
								<div class="item-input">
						  			<input class="phone" type="number" maxlength="11" placeholder="请输入您的手机号">
								</div>
							</div>
			            </div>
			            <div class="item-content">
							<div class="item-inner">
								<div class="item-title label">验证码</div>
								<div class="item-input">
						  			<div class="slider" id="slider">
										<div class="slider-text">向右滑动验证</div>
										<div class="track" id="track">
											<div class="bg-green"></div>
										</div>
										<div class="button-off" id="btn">
											<div class="icon-move" id="icon"></div>
											<div class="spinner" id="spinner"></div>
										</div>
									</div>
								</div>
							</div>
			            </div>
			            <div class="item-content">
							<div class="item-inner">
								<div class="item-title label">校验码</div>
								<div class="item-input">
						  			<input class="verify_code" type="text" maxlength="6">
						  			<input class="msg-send-code get-code" type="button" value="获取校验码" readonly="">
								</div>
							</div>
			            </div>
			            <div class="item-content">
							<div class="item-inner">
								<div class="item-title label">登录密码</div>
								<div class="item-input">
						  			<input class="password register_password" type="password">
								</div>
							</div>
			            </div>
			            <div class="item-content">
							<div class="item-inner">
								<div class="item-title label">确认密码</div>
								<div class="item-input">
						  			<input class="confirm_password register_confirm_password" type="password">
								</div>
							</div>
			            </div>
			        </div>
			        <a class="btn_register_user" href="javascript:;" external>注册</a>
			        <if condition="empty($duid)">
			        	<a href="{:U('user/login')}" external>已有账号，点击登录</a>
			        <else />
			        	<a href="{:U('user/login')}/duid/{$duid}" external>已有账号，点击登录</a>
			        </if>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		//验证码
		var oBtn = document.getElementById('btn');
	    var oW,oLeft;
	    var oSlider=document.getElementById('slider');
	    var oTrack=document.getElementById('track');
	    var oIcon=document.getElementById('icon');
	    var oSpinner=document.getElementById('spinner');
		var flag=1;
		//限制最大宽度
		var oWidth = $('.slider').width();
	 
	    oBtn.addEventListener('touchstart',function(e){
			if(flag==1){
				console.log(e);
				var touches = e.touches[0];
				oW = touches.clientX - oBtn.offsetLeft;
				oBtn.className="button-off";
				oTrack.className="track";
			}
	        
	    },false);
	 
	    oBtn.addEventListener("touchmove", function(e) {
			if(flag==1){
				var touches = e.touches[0];
				oLeft = touches.clientX - oW;
				if(oLeft < 0) {
					oLeft = 0;
				}else if(oLeft > oWidth - oBtn.offsetWidth) {
					oLeft = (oWidth - oBtn.offsetWidth);
				}
				oBtn.style.left = oLeft + "px";
				oTrack.style.width=oLeft+ 'px';			
			}
	        
	    },false);
	 
	    oBtn.addEventListener("touchend",function() {
	        if(oLeft>= oWidth - oBtn.clientWidth ){
	            oBtn.style.left = (oWidth - oBtn.offsetWidth);
	            oTrack.style.width= (oWidth - oBtn.offsetWidth);
	            oIcon.style.display='none';
	            oSpinner.style.display='block';				
				flag=0;			
	        }else{
	            oBtn.style.left = 0;
	            oTrack.style.width= 0;
	        }
	        oBtn.className="button-on";
	        oTrack.className="track-on";       
	    },false);	
		// 获取效验码
		var InterValObj; //timer变量，控制时间
		var count = 600; //间隔函数，1秒执行
		var curCount;//当前剩余秒数
		$('#routers-login-inner-1').find('.msg-send-code').click( function () {			
			if(curCount < count){
				return false;
			}else{
				var jsonData = {
					type: 'send',
					tel: $('#routers-login-inner-1').find('.phone').val(),
					use: 'phone_register',
					interval: 600,
					rd: '{$pagerd}',
				}
				$.post('{:U("common/sms")}', jsonData, function(data){
					if (data.result.errno == 0) {
						sendMessage();					
					} else {
						alert(data.result.message);
					}
				});
			}
		} );
		//获取效验码
		
		function sendMessage() {
			curCount = count;
		　　//设置button效果，开始计时
			//$(this).attr("disabled", "true");
			$(this).html(curCount + "秒内输入");
			InterValObj = setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
		}
		
		//timer处理函数
		function SetRemainTime() {
			if (curCount == 0) {          
				clearInterval(InterValObj);//停止计时器
				$('#routers-login-inner-1').find(".msg-send-code").removeAttr("disabled");//启用按钮
				$('#routers-login-inner-1').find(".msg-send-code").val("重新发送");
				curCount = 600;
			}
			else {
				curCount--;
				$('#routers-login-inner-1').find(".msg-send-code").attr("disabled", "true");
				$('#routers-login-inner-1').find(".msg-send-code").val(curCount + "秒内输入");
			}
		}
		
		$('#routers-login-inner-1').find('.btn_register_user').click(function(){
			var phone = $('#routers-login-inner-1').find('.phone').val();
			if (phone == '' && phone.length != 11) {
				//$('#phone').addClass('bg-red');
				alert('请输入正确的手机号');
				return false;
			}	
			//验证码滑动验证
			if(flag != 0){
				alert('验证码滑动失败');
				return false;
			}
			
			//密码验证
			if($('.register_password').val() == '' || $('.register_confirm_password').val() == ''){
				alert('密码不能为空');
				return false;
			}
			
			// 两次输入密码验证
			var password_login = $('#routers-login-inner-1').find('.register_password').val();
			var password_confirm = $('#routers-login-inner-1').find('.register_confirm_password').val();
			if (password_login != password_confirm) {
				//$('#routers-login-inner-1').find('.confirm_password').addClass('bg-red');
				alert('两次输入密码不同');
				return false;
			}
			
			// 验证效验码
			var jsonData = {
				phone: phone,
				password: password_login,
				code: $('#routers-login-inner-1').find('.verify_code').val(),				
			}
			$.post('{:U("user/register")}', jsonData, function(data){
				if (data.result.errno == 0) {
					alert('注册成功！');
					// 跳转登录						
					if ('{$duid}' != '') {
						location.href = '{:U("user/login")}/duid/{$duid}';
					} else {
						location.href = '{:U("user/login")}';
					}
				} else {
					$('#routers-login-inner-1').find('.code_text').addClass('bg-red');
					alert(data.result.message);
				}
			});
		});
	</script>	
	
	<!-- 找回密码 -->
	<div class="page" id="routers-login-inner-2">
		<header class="bar bar-nav">
			<a class="button button-link button-nav pull-left back" href="#">
		      <i class="iconfont">&#xe606;</i>
		    </a>
		    <h1 class="title">找回密码</h1>
		</header>
		<include file="common/footer" />
		<div class="content">
			<div class="find-psd">
				<div class="list-block">
					<div class="item-content">
						<div class="item-inner">
							<div class="item-title label">手机号</div>
							<div class="item-input">
					  			<input class="phone" type="number" maxlength="11" placeholder="请输入您的手机号">
							</div>
						</div>
		            </div>
		            <div class="item-content">
						<div class="item-inner">
							<div class="item-title label">验证码</div>
							<div class="item-input">
					  			<div class="slider" id="getSlider">
									<div class="slider-text">向右滑动验证</div>
									<div class="track" id="getTrack">
										<div class="bg-green"></div>
									</div>
									<div class="button-off" id="getBtn">
										<div class="icon-move" id="getIcon"></div>
										<div class="spinner" id="getSpinner"></div>
									</div>
								</div>
							</div>
						</div>
		            </div>
		            <div class="item-content">
						<div class="item-inner">
							<div class="item-title label">校验码</div>
							<div class="item-input">
					  			<input class="verify_code" type="text" maxlength="6">
					  			<input class="forget-psd-send-code get-code" type="button" value="获取校验码" readonly="">
							</div>
						</div>
		            </div>
		            <div class="item-content">
						<div class="item-inner">
							<div class="item-title label">新密码</div>
							<div class="item-input">
					  			<input class="password find_password" type="password" placeholder="请输入新密码">
							</div>
						</div>
		            </div>
		            <div class="item-content">
						<div class="item-inner">
							<div class="item-title label">确认密码</div>
							<div class="item-input">
					  			<input class="confirm_password find_confirm_password" type="password" placeholder="请输入确认密码">
							</div>
						</div>
		            </div>
		        </div>
		        <a class="reset_password" href="javascript:;">重置密码</a>
			</div>
		</div>
	</div>
	<script type="text/javascript">	
		//验证码
		var gBtn = document.getElementById('getBtn');
	    var gW,gLeft;
	    var gSlider=document.getElementById('getSlider');
	    var gTrack=document.getElementById('getTrack');
	    var gIcon=document.getElementById('getIcon');
	    var gSpinner=document.getElementById('getSpinner');
		var getFlag=1;
		//限制最大宽度
		var gWidth = $('#getSlider').width();
	 
	    gBtn.addEventListener('touchstart',function(e){
			if(getFlag==1){
				console.log(e);
				var touches = e.touches[0];
				gW = touches.clientX - gBtn.offsetLeft;
				gBtn.className="button-off";
				gTrack.className="track";
			}
	        
	    },false);
	 
	    gBtn.addEventListener("touchmove", function(e) {
	    	console.log(gLeft);
			if(getFlag==1){
				var touches = e.touches[0];
				gLeft = touches.clientX - gW;
				if(gLeft < 0) {
					gLeft = 0;
				}else if(gLeft > gWidth - gBtn.offsetWidth) {
					gLeft = (gWidth - gBtn.offsetWidth);
				}
				gBtn.style.left = gLeft + "px";
				gTrack.style.width = gLeft+ 'px';			
			}
	        
	    },false);
	 
	    gBtn.addEventListener("touchend",function() {
	    	
	        if(gLeft >= gWidth - gBtn.clientWidth ){
	            gBtn.style.left = (gWidth - gBtn.offsetWidth);
	            gTrack.style.width= (gWidth - gBtn.offsetWidth);
	            gIcon.style.display='none';
	            gSpinner.style.display='block';				
				getFlag=0;			
	        }else{
	            gBtn.style.left = 0;
	            gTrack.style.width= 0;
	        }
	        gBtn.className="button-on";
	        gTrack.className="track-on";  
	        
	        console.log(getFlag);     
	    },false);
		
		//发送动态密码
		
		var InterValObj1; //timer变量，控制时间
		var count1 = 600; //间隔函数，1秒执行
		var curCount1;//当前剩余秒数
		$('#routers-login-inner-2').find(".forget-psd-send-code").click( function(){
			var phone = $('#routers-login-inner-2').find('.phone').val();
			if (checkMobile(phone) == false) {
				alert('错误的电话号码');
				return false;
			}
			
			curCount1 = count1;
		　　//设置button效果，开始计时
			$(this).attr("disabled", "true");
			$(this).val(curCount1 + "秒内输入");
			InterValObj1 = setInterval(SetRemainTime1, 1000); //启动计时器，1秒执行一次
		　　 //向后台发送处理数据
			var jsonData = {
				type: 'send',
				tel: phone,
				use: 'phone_forgot_password',
				interval: 600,		
				rd: '{$pagerd}',		
			}
			$.post('{:U("common/sms")}', jsonData, function(data){
				if (data.result.errno == 0) {
				} else {
					alert(data.result.message);
				}
			});
		} );
		
		//timer处理函数
		function SetRemainTime1() {
			if (curCount1 == 0) {          
				clearInterval(InterValObj1);//停止计时器
				$('#routers-login-inner-2').find(".forget-psd-send-code").removeAttr("disabled");//启用按钮
				$('#routers-login-inner-2').find(".forget-psd-send-code").val("重新发送");
			}
			else {
				curCount1--;
				$('#routers-login-inner-2').find(".forget-psd-send-code").attr("disabled", "disabled");
				$('#routers-login-inner-2').find(".forget-psd-send-code").val(curCount1 + "秒内输入");
				event.preventDefault();
			}
		}
		
		// 重置密码
		$('#routers-login-inner-2').find('.reset_password').click(function(){					
			var sphone = $('#routers-login-inner-2').find('.phone').val();
			if (checkMobile(sphone) == false) {
				alert('错误的电话号码');
				return false;
			}			
			
			//验证码滑动验证
			if (getFlag != 0){
				alert('验证码滑动失败');
				return false;
			}
			
			//若没有输入密码
			if($('.find_password').val() == '' || $('.find_confirm_password').val() == ''){
				alert('请输入密码');
				return false;
			}
			
			var scode = $('#routers-login-inner-2').find('.verify_code').val();
			if (scode.length != 6) {
				alert('验证码错误');
				return false;
			}
			
			var newPassword = $('#routers-login-inner-2').find('.password').val();
			var comfirmPassword = $('#routers-login-inner-2').find('.confirm_password').val();
			if (newPassword != comfirmPassword) {
				alert('两次输入的密码不一致');
				return false;
			}
			
			var jsonData = {
				phone: sphone,
				code: scode,
				password: newPassword,
			}
			if ('{$duid}' != '') {
				jsonData['duid'] = '{$duid}';
			}
			
			$.post('{:U("user/forgotPassword")}', jsonData, function(data){
				if (data.result.errno == 0) {
					location.href = '{:U("index/welcome")}';
				} else {
					alert(data.result.message);
				}
			});
		});
	</script>
	
	<script>
		$(function(){
			$.init();
		});
	</script>
<include file="common/swt" />
</body>
</html>