<include file="common/top" />
<!-- mycss -->
<link rel="stylesheet" href="__PUBLIC__/phone/css/order_create_test.css">
<style>
.stage{position:relative;padding: 0 15px;height:55px;}
.slider{position:absolute; width: 200px; height:32px;box-shadow:0 0 3px #999;background-color:#ddd;left:6px;top:-17px;}
.slider-text {
    background: -webkit-gradient(linear, left top, right top, color-stop(0, #4d4d4d), color-stop(.4, #4d4d4d), color-stop(.5, white), color-stop(.6, #4d4d4d), color-stop(1, #4d4d4d));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    -webkit-animation: slidetounlock 3s infinite;
    -webkit-text-size-adjust: none;
    line-height: 32px;
    height: 32px;
    text-align: center;
    font-size: 16px;
    width: 200px;
    color: #aaa;
}
@keyframes slidetounlock
{
    0%     {background-position:-200px 0;}
    100%   {background-position:200px 0;}
}
@-webkit-keyframes slidetounlock
{
    0%     {background-position:-200px 0;}
    100%   {background-position:200px 0;}
}
.button-off{
    position: absolute;
    left: 0;
    top: 0;
    width: 32px;
    height: 32px;
    background-color: #fff;
    transition: left 0s;
    -webkit-transition: left 0s;
}
.button-on{
    position: absolute;
    left: 0;
    top: 0;
    width: 32px;
    height: 32px;
    background-color: #fff;
    transition: left 1s;
    -webkit-transition: left .5s;
}
.track{
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    overflow: hidden;
    transition: width 0s;
    -webkit-transition: width 0s;
    z-index: 10;
}
.track-on{
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    overflow: hidden;
    transition: width 1s;
    -webkit-transition: width .5s;
}
.icon-move  {
    width: 32px;
    height: 32px;
    position: relative;
    top:1px;
    left:10px;
    font-family: sans-serif;
}
.icon-move:before{
    content:'>>';
    color:#ccc;
    line-height:32px;
}
.spinner {
    width: 20px;
    height: 20px;	
	background: url('__PUBLIC__/phone/images/order_create/code_ok.png') no-repeat;
    position: relative;
    top:6px;
    left:6px;
    background-size: 100% 100%;
    display: none;
}

@-webkit-keyframes bouncedelay {
    0%, 80%, 100% { -webkit-transform: scale(0.0) }
    40% { -webkit-transform: scale(1.0) }
}
@keyframes bouncedelay {
    0%, 80%, 100% {
        transform: scale(0.0);
        -webkit-transform: scale(0.0);
    } 40% {
          transform: scale(1.0);
          -webkit-transform: scale(1.0);
      }
}
.bg-green {
    line-height: 32px;
    height: 32px;
    text-align: center;
    font-size: 16px;
    background-color: #78c430;
}
</style>
<!-- 日历项模板 -->

<div class="information template_date_item hidden_ctrl">

	<img src="__PUBLIC__/home/images/content_img/yellow_arrow_bottom.png" alt="" />

	<p class="information-state"></p>

	<p class="information-money">元</p>

	<div class="information-details">

	</div>

</div>
	<div class="page">
		<header class="bar bar-nav">
			<a class="button button-link button-nav pull-left back" href="{:U('line/info')}/id/{$line.id}" external>
		      <i class="iconfont">&#xe606;</i>
		    </a>
		    <h1 class="title">领袖户外欢迎您</h1>
		</header>
		<nav class="bar bar-tab">
		    <a class="tab-item active" style="width: 2%; color: #000;" href="#">
		      <span>总价 <strong style="color: #ff7200; font-size: 1.25rem;">￥</strong><strong class="total_money" style="color: #ff7200; font-size: 1.25rem;">0</strong></span>
		    </a>
		    <a id="comfirm_order" class="tab-item" style="background-color: #ff7200; color: #fff;" href="javascript:;" external>
		      <span>提交订单</span>
		    </a>
		</nav>
		<div class="content">
			<div class="order-write">
				<div class="order-write-information">
					<h4>新疆全景</h4>
					<p class="err_msg"></p>
					<div class="list-block">
						<div class="tclx">
							<div class="item-content">
								<div class="item-inner">
									<div class="item-title label">套餐类型：</div>
								</div>
							</div>
							<span class="active">新疆全境8日休闲游</span>
							<span class="disabled">天山环线深度游9日</span>
							<span>北疆金秋经典环线9日深度游</span>
						</div>
						<div style="clear: both;"></div>
						<div class="item-content" style="border-top: 1px solid #eee;">
							<div class="item-inner">
								<div class="item-title label">线路价格：</div>
								<div class="item-input">
									<span class="price_adult">成人￥{$cur_batch.price_adult}</span>
									<span class="price_child">儿童￥{$cur_batch.price_child}</span>
								</div>
							</div>
						</div>
						<div class="item-content" style="border-top: 1px solid #eee;">
							<div class="item-inner">
								<div class="item-title label">出游人数：</div>
								<div class="item-input">
									<div class="people-num">
										<div class="row">
											<if condition="empty($check['only_child']) eq true">
												<div class="col-50">
													<div class="change-people-num adult_man" data-type="adult_man">
														<a href="javascript:;" external>-</a>
														<span>{$member_male_count}</span>
														<a href="javascript:;" external>+</a>
													</div>	
													成人男
												</div>
												<div class="col-50">
													<div class="change-people-num adult_woman" data-type="adult_woman">
														<a href="javascript:;" external>-</a>
														<span>{$member_woman_count}</span>
														<a href="javascript:;" external>+</a>
													</div>
													成人女
												</div>
											</if>
											<if condition="empty($check['only_adult']) eq true">
												<div class="col-90">
													<div class="change-people-num child" data-type="child">
														<a href="javascript:;" external>-</a>
														<span>{$member_child_count}</span>
														<a href="javascript:;" external>+</a>
													</div>
													儿童
												</div>
											</if>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--日历-->
				<div class="rili">
					<p class="riqi">出发日期: <span>2017-07-07出发</span> , <span>2017-07-12返回</span></p>
					<div class="calendar" id="calendar">
	            		<div  class="calendar-nav">
							<!--<a href="javascript:;" class="fa  fa-2x fa-angle-left arrow"><i class="iconfont">&#xe649;</i></a>-->
							<!--<a href="javascript:;" class="fa fa-2x fa-angle-right arrow"><i class="iconfont">&#xe600;</i></a>-->
							<div class="calendar_nav" id="calendar_nav"></div>
						</div> 
						<ul class="calendar_week">
							<li>日</li>
							<li>一</li>
							<li>二</li>
							<li>三</li>
							<li>四</li>
							<li>五</li>
							<li>六</li>
						</ul>
						<div class="calendar_content"  id="calendarDiv"></div>
					</div>
				</div>
				<!-- 联系人信息 -->
				<div class="contact-information">
					<h5><img src="__PUBLIC__/phone/images/order_create/sublist_logo.png" alt="">联系人信息</h5>
					<div class="content-padded">
						<div class="list-block">
							<div class="item-inner">
								<div class="item-title label">姓名：</div>
								<div class="item-input">
									<input id="contact_name" type="text" placeholder="请输入您的姓名">
								</div>
							</div>
							<div class="item-inner">
								<div class="item-title label">联系电话：</div>
								<div class="item-input">
									<input id="contact_phone" type="text" placeholder="请输入您的联系电话">
								</div>
							</div>
							<div class="item-inner">
								<div class="item-title label">验证码：</div>
								<div class="item-input">
									<div class="slider" id="slider">
										<div class="slider-text">向右滑动验证</div>
										<div class="track" id="track">
											<div class="bg-green"></div>
										</div>
										<div class="button-off" id="btn">
											<div class="icon-move" id="icon"></div>
											<div class="spinner" id="spinner"></div>
										</div>
									</div>
								</div>
							</div>
							<if condition="empty($user) eq true">
								<div class="item-inner">
									<div class="item-title label">校验码：</div>
									<div class="item-input">
										<input id="contact_verify_code" type="text" placeholder="请输入校验码">
										<input id="btnSendCode" class="get-code" type="button" value="发送校验码" readonly="">
										<span id="contact_result"></span>
									</div>
								</div>
							</if>
						</div>
					</div>
				</div>

				<!-- 旅客信息模板 -->				
				<div class="passenger-information-list template_member hidden_ctrl">
					<div class="item-inner">
						<div class="item-title label">游客<span class="sort"></span>：</div>
						<div class="item-input">
							<input class="name" type="text" placeholder="请输入您的真实姓名">
						</div>
					</div>
					<div class="item-inner">
						<div class="item-title label">游客类型：</div>
						<div class="item-input">
							<span class="member_type" data-id=""></type>
						</div>
					</div>
					<div class="item-inner">
						<div class="item-title label">证件类型：</div>
						<div class="item-input">
							<input class="cert" type="text" placeholder="请选择您的证件类型" readonly="">
						</div>
					</div>
					<div class="item-inner">
						<div class="item-title label">证件号码：</div>
						<div class="item-input">
							<input class="cert_num" type="text" placeholder="请输入您的证件号码">
						</div>
					</div>
					<div class="item-inner">
						<div class="item-title label">联系电话：</div>
						<div class="item-input">
							<input class="tel" type="text" placeholder="请输入您的联系电话">
						</div>
					</div>
					<if condition="empty($largess) eq false">
						<div class="largess-root">
							<div style="width:100%;padding:10px 0px 5px 12%;color:#000;border-bottom:1px solid #ddd;">赠品：</div>
							<volist id="l" name="largess">
								<div class="item-inner largess-item" data-id="{$l.id}">
									<div class="item-title label">{$l.type_desc}：</div>
									<div class="item-input">
					        			<input class="largess" data-key="{$l.type_key}" data-desc="{$l.type_desc}" type="text" placeholder="请选择" readonly="">
									</div>
								</div>
							</volist>
						</div>
					</if>
				</div>
				<!-- 旅客信息 -->
				<div class="passenger-information">
					<h5><img src="__PUBLIC__/phone/images/order_create/sublist_logo.png" alt="">旅客信息</h5>
					<div class="list-block">
						<volist id="m" name="members">
							<div class="passenger-information-list">
								<div class="item-inner">
									<div class="item-title label">游客<span class="sort">{$key+1}</span>：</div>
									<div class="item-input">
										<input class="name" type="text" placeholder="请输入您的真实姓名">
									</div>
								</div>
								<div class="item-inner">
									<div class="item-title label">游客类型：</div>
									<div class="item-input">
										<span class="member_type {$m.type_key}" data-id="{$m.id}">{$m.type_desc}</type>
									</div>
								</div>
								<div class="item-inner">
									<div class="item-title label">证件类型：</div>
									<div class="item-input">
										<input class="cert" type="text" placeholder="请选择您的证件类型" readonly="">
									</div>
								</div>
								<div class="item-inner">
									<div class="item-title label">证件号码：</div>
									<div class="item-input">
										<input class="cert_num" type="text" placeholder="请输入您的证件号码">
									</div>
								</div>
								<div class="item-inner">
									<div class="item-title label">联系电话：</div>
									<div class="item-input">
										<input class="tel" type="text" placeholder="请输入您的联系电话">
									</div>
								</div>
								<if condition="empty($largess) eq false">
									<div class="largess-root">
										<div style="width:100%;padding:10px 0px 5px 12%;color:#000;border-bottom:1px solid #ddd;">赠品：</div>
										<volist id="l" name="largess">
											<div class="item-inner largess-item" data-id="{$l.id}">
												<div class="item-title label">{$l.type_desc}：</div>
												<div class="item-input">
					        						<input class="largess" data-key="{$l.type_key}" data-desc="{$l.type_desc}" type="text" placeholder="请选择" readonly="">
												</div>
											</div>
										</volist>
									</div>
								</if>
							</div>
						</volist>
					</div>
				</div>


				<!-- 出游人信息 -->
				<div class="travel-people-information">
					<h5>出游人信息</h5>
					<div class="content-padded">
						<div class="travel-people-list old-man">
							出游人中是否有60周岁(含)至80周岁(不含)的老人？
							<p><span data-id="1"><img src="__PUBLIC__/phone/images/order_create/no_checked.png" alt="">有</span><span class="has-checked" data-id="0"><img src="__PUBLIC__/phone/images/order_create/checked.png" alt="">没有</span></p>
						</div>
						<div class="travel-people-list foreign-man">
							出游人中是否有港澳同胞？
							<p><span data-id="1"><img src="__PUBLIC__/phone/images/order_create/no_checked.png" alt="">有</span><span class="has-checked" data-id="0"><img src="__PUBLIC__/phone/images/order_create/checked.png" alt="">没有</span></p>
						</div>
						<div class="travel-people-list gat-man">
							出游人中是否有外籍友人？
							<p><span data-id="1"><img src="__PUBLIC__/phone/images/order_create/no_checked.png" alt="">有</span><span class="has-checked" data-id="0"><img src="__PUBLIC__/phone/images/order_create/checked.png" alt="">没有</span></p>
						</div>
						<p>本产品不支持孕妇或者80周岁(含)以上的老人出游，18周岁以下的未成年人必须有成年人陪同出游，敬请谅解！</p>
					</div>
				</div>
			</div>
		</div>
	</div>

<include file="common/js" />
<script>
	//日历
		var oDiv = document.getElementById('calendar_nav');
		var oDate = new Date();
		var Syear = oDate.getFullYear();
	    var Smonth = oDate.getMonth()+1;
	    if(Smonth<10){
	    	Smonth = "0"+ Smonth
	    }else{
	    	Smonth = Smonth
	    }
		var oCalendar = document.getElementById('calendarDiv');
		calendarTit(oDiv,oCalendar,Syear,parseInt(Smonth));
		var bBtn = true;
		
	function finalDay() {
        for (var n = 1; n < $('#calendarDiv tr td').length + 1; n++) {
            if (n % 7 == 0) {
                $('#calendarDiv tr td:eq('+ (n - 1) +')').addClass('final-day');
            }
        };
    }

    // 初始化批次信息
    function initCalendarBatch(y) {
        var lineId = '{$line.id}';
        var type = 'find_batch';
        
        //套餐选中
        var taocanIds = ',';
		$('.tclx .taocan-list').find('div.active').each(function(){
			taocanIds += $(this).attr('data-id') + ',';
		});
		if (taocanIds != ',') {
        	type = 'find_taocan_batch';
        }
		
		//批次选中
		var batchId = '';

        var jsonData = {
        	type:type,
        	line_id:lineId,
        	year:y,
        	taocan_ids:taocanIds,
        	batch_id:batchId,	
        };
        $.post('{:U("line/info")}', jsonData, function(data){
			console.log(data)
            if (data.result.errno == 0) {				
                var batchs = new Object();
                if (data.ds != null && typeof(data.ds) != 'undefined') {
                    for (var i = 0; i < data.ds.length; i++) {
                        var tempDate = new Date(Date.parse(data.ds[i]['start_time'].replace(/-/g,"/")));
                        var td = tempDate.getFullYear()+'-'+(tempDate.getMonth()+1)+'-'+tempDate.getDate();
                        batchs[td] = data.ds[i];
                    }
                }

                $('#calendarDiv tr td').each( function(){
                	$(this).find('.information').remove();
                	$(this).removeClass('black');
                	$(this).removeClass('gogogo');
                    var curDate = $(this).attr('data-date');                    
                    if (typeof(batchs[curDate]) != 'undefined') {						
                        var b = batchs[curDate];
                        var itemObj = $('.template_date_item').clone(true);
                        $(itemObj).removeClass('template_date_item');
                        $(itemObj).removeClass('hidden_ctrl');
                        $(itemObj).find('img').attr('__PUBLIC_/home/images/content_img/yellow_arrow_bottom.png');
//                      $(itemObj).find('.information-people').html('余'+b.sub_member);
 						$(itemObj).attr("data-number",b.end_date_show); 						
                        var state = $.parseJSON(b.state);
                        
                        $(itemObj).find('.information-state').html(state.type_desc);
                        
                        if(state.type_desc == "确认成行"){
							$(itemObj).find('.information-state').addClass("orange");
						}
						if(state.type_desc == "可报名"){
							$(itemObj).find('.information-state').addClass("blue");
						}
						if(state.type_desc == "名额紧张"){
							$(itemObj).find('.information-state').addClass("red");
						}
						
                        if (b.price_adult == 0 && b.price_child == 0 && '{$line.free_line}' == '0') {
//                          $(itemObj).find('.adult-money').parent().html('成人价格：<span class="adult-money">核算中</span>');
//                          $(itemObj).find('.children-money').parent().html('儿童价格：<span class="children-money">核算中</span>');
                            $(itemObj).find('.information-money').html('核算中');
                        } else {
                            $(itemObj).find('.adult-money').html(b.price_adult);
                            $(itemObj).find('.children-money').html(b.price_child);
                            $(itemObj).find('.information-money').html(b.price_adult+'元');
                        }
                        
                        $(this).addClass('gogogo');
                        $(this).attr('data-batch-id', b.id);
                        $(this).append(itemObj);
                    }
                });
            } else {
                console.log(data.result.message);
            }
            finalDay();
        });
    }
	
	 // calendar_nav里span的内容 
	 function  calendarTit(obj,obj1,year,month){

		 var oDate = new Date(year,month-1);
		//var oDate;
		 for(var i=-12; i<12; i++){
			 var ospan = document.createElement('span');
			 obj.appendChild(ospan);
			 ospan.innerHTML ='<b>'+year+'年</b>'+(month+i)+'月';
			 ospan.setAttribute("mouth",(month+i));
			 ospan.setAttribute("year",year);
			 if((month+i)>12){
				 year = oDate.getFullYear()+1;
				 ospan.innerHTML ='<b>'+year+'年</b>'+((month+i)-12)+'月';
				 ospan.setAttribute("mouth",((month+i)-12));
				 ospan.setAttribute("year",year);
			 }
			 if((month+i)<1){
				 year = oDate.getFullYear()-1;
				 ospan.innerHTML ='<b>'+year+'年</b>'+((month+i)+12)+'月';
				 ospan.setAttribute("mouth",((month+i)+12));
				 ospan.setAttribute("year",year);
			 }
			 if((month+i)>0 && (month+i)<12){
				 year = oDate.getFullYear();
				 ospan.innerHTML ='<b>'+year+'年</b>'+((month+i))+'月';
				 ospan.setAttribute("mouth",((month+i)));
				 ospan.setAttribute("year",year);
			 }
			 if((month+i)>0 && (month+i)<10){
				 year = oDate.getFullYear();
				 ospan.innerHTML ='<b>'+year+'年</b>'+((month+i))+'月';
				 ospan.setAttribute("mouth",((month+i)));
				 ospan.setAttribute("year",year);
			 }
			 var oCon = document.createElement('div');
			 obj1.appendChild(oCon);
			 $(".calendar_nav").children().hide();
			 $(".calendar_nav").children().slice(12,18).show();

		 }

		 for(var j=0; j<24; j++){
			 var aSpan = obj.children;
			 var aCon = obj1.children;
			 aSpan[12].className = 'active';
			 var oDate = new Date();
			 showDate(aCon[12],aSpan[12].getAttribute("year"),aSpan[12].getAttribute("mouth"),true);
			 aSpan[j].index = j;

		 }

	 }
	 //获取当天
		var spanlength =  oCalendar.getElementsByTagName('span');
		var now = new Date();
		for(var i=0;i<spanlength.length; i++) {
			if(spanlength[i].getAttribute("day")==now.getDate() && spanlength[i].getAttribute("month")==(now.getMonth()+1) && spanlength[i].getAttribute("year")==now.getFullYear() ){
				spanlength[i].className='today';
			}
		}
	 
	 function showDate(obj,year,month,bBtn){
		 var oDate = new Date();
		 var dayNum = 0;
		 if(!obj.bBtn){
			 var oTable = document.createElement('table');
			 var oTbody = document.createElement('tBody');
			 for(var i=0;i<6;i++){
				 var oTr = document.createElement('tr');
				 for(var j=0;j<7;j++){
					 var ospan = document.createElement('span');
					 var oTd = document.createElement('td');
					 oTd.appendChild(ospan);
					 oTr.appendChild(oTd);
				 }
				 oTbody.appendChild(oTr);

			 }
			 oTable.appendChild(oTbody);
			 obj.appendChild(oTable);

			 obj.bBtn = true;
		 }
		 //添加天数
		 var aTd = obj.getElementsByTagName('span');
		 for(var i=0;i<aTd.length;i++){
			 aTd[i].innerHTML = ''; 
		 }

		 if(month==1 || month==3 || month==5 || month==7 || month==8 || month==10 || month==12){
			 dayNum = 31;
		 }
		 else if(month==4 || month==6 || month==9 || month==11){
			 dayNum = 30;
		 }
		 else if(month==2 && isLeapYear(year)){
			 dayNum = 29;
		 }
		 else{
			 dayNum = 28;
		 }
		
		 oDate.setFullYear(year);
		 oDate.setMonth(month-1);
		 oDate.setDate(1); 
		 for(var i=0;i<dayNum;i++){
			 aTd[i+oDate.getDay()].innerHTML = i+1;
			 $(aTd[i+oDate.getDay()]).attr('year',year);
			 $(aTd[i+oDate.getDay()]).attr('month',month);
			 $(aTd[i+oDate.getDay()]).attr('day',i+1);
			 $(aTd[i+oDate.getDay()]).parent("td").attr('data-date',year+"-"+month+"-"+(i+1));
		 }
		 
		for(var i=0;i<aTd.length;i++){
			if(aTd[i].innerHTML==''){
				aTd[i].parentNode.className='bg_black';
			}
		}
		
		//润年
		function isLeapYear(year){
			if(year%4==0 && year%100!=0){
				return true;
			}
			else{
				if(year%400==0){
					return true;
				}else{
					return false;
				}
			}
		}
	 }

//	$(document).on('mouseover', '.gogogo', function () {
//		var data_duibi = $(this).attr("data-date");
//		var panduan_yue = $(this).attr("data-date").substr(6,1);
//		if(panduan_yue == "-"){
//			var data_yue = parseInt($(this).attr("data-date").substr(5,1));
//			var data_date = parseInt($(this).attr("data-date").substr(7,2));
//		}else{
//			var data_yue = parseInt($(this).attr("data-date").substr(5,2));
//			var data_date = parseInt($(this).attr("data-date").substr(8,2));
//		}
//
//
//		var date = $(this).find(".information").attr("data-number");
//		var data_number = parseInt($(this).find(".information").attr("data-number").substr(8,2));
//		if(data_date < data_number){
//			var number = data_number - data_date
//		}else{
//			if(data_yue==1 || data_yue==3 || data_yue==5 || data_yue==7 || data_yue==8 || data_yue==10 || data_yue==12){
//				var number = (31-data_date)+data_number
//			}else if(data_yue==4 || data_yue==6 || data_yue==9 || data_yue==11){
//				var number = (30-data_date)+data_number
//			}else if(data_yue==2 && isLeapYear(year)){
//				var number = (29-data_date)+data_number
//			}else{
//				var number = (28-data_date)+data_number
//			}
//		}
//		var thisObj = this;
//		var day = number+1, startChange = false;
//		var tdObjs = $('#calendarDiv').find('table tbody td').each(function(i, ev){
//			if (this == thisObj) {
//				startChange = true;
//			}
//			if (startChange && day > 0) {
//				$(this).addClass("bg_yellow");
//				day--;
//			}
//		});
//	})
//	$(document).on('mouseout', '.gogogo', function () {
//		var data_duibi = $(this).attr("data-date");
//		var panduan_yue = $(this).attr("data-date").substr(6,1);
//		if(panduan_yue == "-"){
//			var data_yue = parseInt($(this).attr("data-date").substr(5,1));
//			var data_date = parseInt($(this).attr("data-date").substr(7,2));
//		}else{
//			var data_yue = parseInt($(this).attr("data-date").substr(5,2));
//			var data_date = parseInt($(this).attr("data-date").substr(8,2));
//		}
//
//
//		var date = $(this).find(".information").attr("data-number");
//		var data_number = parseInt($(this).find(".information").attr("data-number").substr(8,2));
//		if(data_date < data_number){
//			var number = data_number - data_date
//		}else{
//			if(data_yue==1 || data_yue==3 || data_yue==5 || data_yue==7 || data_yue==8 || data_yue==10 || data_yue==12){
//				var number = (31-data_date)+data_number
//			}else if(data_yue==4 || data_yue==6 || data_yue==9 || data_yue==11){
//				var number = (30-data_date)+data_number
//			}else if(data_yue==2 && isLeapYear(year)){
//				var number = (29-data_date)+data_number
//			}else{
//				var number = (28-data_date)+data_number
//			}
//		}
//		var thisObj = this;
//		var day = number+1, startChange = false;
//		var tdObjs = $('#calendarDiv').find('table tbody td').each(function(i, ev){
//			if (this == thisObj) {
//				startChange = true;
//			}
//			if (startChange && day > 0) {
//				$(this).removeClass("bg_yellow");
//				day--;
//			}
//		});
//	});
    
    //点击批次选中
	$(document).on('click', '.gogogo', function () {
		//高亮显示
        $(this).parents('#calendarDiv div').find('.gogogo').removeClass('bg-high-color');
        $(this).parents('#calendarDiv div').siblings().find('.gogogo').removeClass('bg-high-color');
        $(this).addClass('bg-high-color');
        
        //获取日历上被点击的日期
        var  dateNum = $(this).attr('data-date');
        if(parseInt(dateNum.substr(5,2)) < 10){
            var dateArr1 = dateNum.split('-');
            dateArr1[1] = '0' + dateArr1[1];
            dateNum = dateArr1.join('-');
        };
        if(parseInt(dateNum.substr(-2,2)) < 10){
            var dateArr2 = dateNum.split('-');
            dateArr2[2] = '0' + dateArr2[2];
            dateNum = dateArr2.join('-');
        };

        
        //设置套餐可选状态
		$('.tclx span').each(function(){
			$(this).removeClass();
			$(this).addClass('disabled');
		});
        var lineId = '{$line.id}';
        var mouth = $('#calendar_nav').find('span.active').attr("mouth");
		var year = $('#calendar_nav').find('span.active').attr("year");
		if(mouth <= 9){
			mouthnext= "0"+mouth
		}else{
			mouthnext= mouth
		}
		
		var batchId = $(this).attr('data-batch-id');		
        var jsonData = {
        	type:'find_taocan_batch',
        	line_id:lineId,
        	year:year+"-"+mouthnext,
        	batch_id:batchId,
        };
        $.post('{:U("line/info")}', jsonData, function(data){
        	console.log(data);
        	if (data.result.errno == 0) {
        		if (data.taocan_ids != null && typeof(data.taocan_ids) != 'undefined') {
                     for(i = 0; i < data.taocan_ids.length; i++){
					 	$('.tclx .taocan-list').find('div[data-id="'+data.taocan_ids[i]+'"]').removeClass();
					 }
                }
        	}
        });        
        
		initCalendarBatch(year+"-"+mouthnext);
    });
    
//  $('.cfrq_batch_list li').on("click",function(){
//  	$('#calendarDiv div').find('.gogogo').removeClass('bg-high-color');
//      $('#calendarDiv div').siblings().find('.gogogo').removeClass('bg-high-color');
//      
//      var nianyue = $(this).attr("data-val");
//      var nian = nianyue.substr(0,4);
//      var yue =  nianyue.substr(5,2);
//     	if(yue<10){
//      	var yueyue = yue.substr(1,1);
//      }else(
//      	yueyue = yue
//      )
//      var ri =  nianyue.substr(8,2);
//      if(ri<10){
//      	var ri = ri.substr(1,1);
//      }else(
//      	ri = ri
//      )
//      var nianyueri = nian+"-"+yueyue+"-"+ri
//      var spans = $("#calendar_nav span");
//      
//      if (!!document.getBoxObjectFor || window.mozInnerScreenX != null) {
//	    	HTMLElement.prototype.__defineSetter__("outerText", function(sText) {
//		        var parsedText = document.createTextNode(sText);
//		        this.parentNode.replaceChild(parsedText, this);
//		        return parsedText;
//  		});
//		    HTMLElement.prototype.__defineGetter__("outerText", function() {
//		        var r = this.ownerDocument.createRange();
//		        r.selectNodeContents(this);
//		        return r.toString();
//		    });
//		}	
//      for(var i=0;i<spans.length;i++){
//      	var rilinian = spans[i].outerText.substr(0,4)
//      	var panduanyue  = spans[i].outerText.substr(6,1)
//      	if(panduanyue == "月"){
//      		var riliyue = "0"+spans[i].outerText.substr(5,1)
//      	}else{
//      		var riliyue = spans[i].outerText.substr(5,2)
//      	}
//      	if(rilinian == nian && riliyue == yue){
//      		spans[i].click();
//      	}
//      }
//      var tds = $("#calendarDiv div").find("td");
//      for(var j=0;j<tds.length;j++){
//      	if(tds[j].dataset.date == nianyueri){
//      		$(tds[j]).addClass("bg-high-color");
//      	}
//		}
//  });
//	   
 	//右箭头
//	$(".fa-angle-right").click(function(){
//		var mouth = $(".calendar_nav").children("span[class=active]").attr("mouth");
//		var year = $(".calendar_nav").children("span[class=active]").attr("year");
//		 
//		var mouthnext = $(".calendar_nav").children("span[class=active]").next().attr("mouth");
//		var yearnext = $(".calendar_nav").children("span[class=active]").next().attr("year");
//		 
//		if(mouthnext <= 9){
//			mouthnext= "0"+mouthnext
//		}else{
//			mouthnext= mouthnext
//		}
//		var index = $(".calendar_nav").children("span[class=active]").index();
//		console.log(index);
//		if(index>22 || index<0 || isNaN(index)){
//			$(".calendar_nav").children().eq(23).addClass("active").show();
//			$(".calendar_content").children().eq(23).show();
//			e.stopPropagation();
//			return false;
//		}
//		$(".calendar_nav").children().removeClass("active");
//		$(".calendar_nav").children().eq(index+1).addClass("active").show();
//
//		$(".calendar_content").children().hide();
//		$(".calendar_content").children().eq(index+1).show().addClass("load-right");
//		$(".calendar_content").children().eq(index).addClass("load-right");
//		if(index>=5){
//			$(".calendar_nav").children().eq(index-5).hide();
//		}
//		if($(".calendar_content").children().eq(index+1).hasClass("load-left") || $(".calendar_content").children().eq(index+1).hasClass("load")){
//			
//		}else{
//			showDate($(".calendar_content").children().eq(index+1)[0],$(".calendar_nav").children("span[class=active]").attr("year"),$(".calendar_nav").children("span[class=active]").attr("mouth"),true);
//			if(index>=5){
//				$(".calendar_nav").children().eq(index-5).hide();
//			}
//		}
//		// 初始化批次信息
//		initCalendarBatch(yearnext+"-"+mouthnext);
//		console.log(yearnext+"-"+mouthnext);		
//	 });
	 
	 //左箭头
//	 $(".fa-angle-left").click(function(){
//		 var mouth = $(".calendar_nav").children("span[class=active]").attr("mouth");
//		 var year = $(".calendar_nav").children("span[class=active]").attr("year");
//		 
//		 var mouthnext = $(".calendar_nav").children("span[class=active]").prev().attr("mouth");
//		 var yearnext = $(".calendar_nav").children("span[class=active]").prev().attr("year");
//		 
//		 if(mouthnext <= 9){
//		 	mouthnext= "0"+mouthnext
//		 }else{
//		 	mouthnext= mouthnext
//		 }
//		 
//		 var index = $(".calendar_nav").children("span[class=active]").index();
//		 console.log(index)
//		 if(index==0 || isNaN(index)){
//			 $(".calendar_nav").children().eq(0).addClass("active").show();
//			 $(".calendar_content").children().eq(0).show();
//			 e.stopPropagation();
//
//			 return false;
//		 }
//		 $(".calendar_nav").children().slice(index,index+7).show();
//		 $(".calendar_nav").children().removeClass("active");
//		 $(".calendar_nav").children().eq(index-1).addClass("active").show();
//		 $(".calendar_content").children().hide();
//		 $(".calendar_content").children().eq(index-1).show().addClass("load-left");
//		 $(".calendar_content").children().eq(index).addClass("load-left");
//		 if($(".calendar_content").children().eq(index-1).hasClass("load-right") || $(".calendar_content").children().eq(index-1).hasClass("load")){
//		 }else{
//		 	showDate($(".calendar_content").children().eq(index-1)[0],$(".calendar_nav").children("span[class=active]").attr("year"),$(".calendar_nav").children("span[class=active]").attr("mouth"),true);
//			 if(index>11){
//				 $(".calendar_nav").children().eq(index+7).hide();
//			 }
//		 }
//		 // 初始化批次信息
//       initCalendarBatch(yearnext+"-"+mouthnext);
//       console.log(yearnext+"-"+mouthnext);
//	 });
	 
	 //点击月份
	 $("#calendar_nav").on("click","span",function(){
		 var mouth = $(this).attr("mouth");
		 var year = $(this).attr("year");
		 
		 if(mouth <= 9){
		 	mouthnext= "0"+mouth
		 }else{
		 	mouthnext= mouth
		 }
		 var index = $(this).index();
		 console.log(index)
		 if(index==0 || isNaN(index)){
			 $(".calendar_nav").children().eq(0).addClass("active").show();
			 $(".calendar_content").children().eq(0).show();
			 e.stopPropagation();

			 return false;
		 }
		 $(".calendar_nav").children().slice(index,index+7).show();
		 $(".calendar_nav").children().removeClass("active");
		 $(this).addClass("active").show();
		 $(".calendar_content").children().hide();
		 $(".calendar_content").children().eq(index).show();
		 if($(".calendar_content").children().eq(index).hasClass("load") || $(".calendar_content").children().eq(index).hasClass("load-left") ||$(".calendar_content").children().eq(index).hasClass("load-right")){
		 }else{
		 	showDate($(".calendar_content").children().eq(index)[0],$(".calendar_nav").children("span[class=active]").attr("year"),$(".calendar_nav").children("span[class=active]").attr("mouth"),true);
			 if(index>11){
				 $(".calendar_nav").children().eq(index+7).hide();
			 }
		 }
		 // 初始化批次信息
         initCalendarBatch(year+"-"+mouthnext);
         console.log(year+"-"+mouthnext);
		 $(".calendar_content").children().eq(index).addClass("load");
	 });
	 //套餐类型
	$(".tclx span").on("click",function(){
		if ($(this).hasClass('disabled')) {
			return false;
		}
		var number = $(this).attr("data-date")
		if(number == 1){
			$(this).addClass("disabled")
		}else{
			$(this).toggleClass("active").siblings().removeClass("active");
		}
		
	});
</script>
<script>
	$(function(){
		$.init();
		
		//验证码
		
	    var oBtn = document.getElementById('btn');
	    var oW,oLeft;
	    var oSlider=document.getElementById('slider');
	    var oTrack=document.getElementById('track');
	    var oIcon=document.getElementById('icon');
	    var oSpinner=document.getElementById('spinner');
		var flag=1;
		//限制最大宽度
		var oWidth = $('.slider').width();
	 
	    oBtn.addEventListener('touchstart',function(e){
			if(flag==1){
				console.log(e);
				var touches = e.touches[0];
				oW = touches.clientX - oBtn.offsetLeft;
				oBtn.className="button-off";
				oTrack.className="track";
			}
	        
	    },false);
	 
	    oBtn.addEventListener("touchmove", function(e) {
			if(flag==1){
				var touches = e.touches[0];
				oLeft = touches.clientX - oW;
				if(oLeft < 0) {
					oLeft = 0;
				}else if(oLeft > oWidth - oBtn.offsetWidth) {
					oLeft = (oWidth - oBtn.offsetWidth);
				}
				oBtn.style.left = oLeft + "px";
				oTrack.style.width=oLeft+ 'px';			
			}
	        
	    },false);
	 
	    oBtn.addEventListener("touchend",function() {
	        if(oLeft>= oWidth - oBtn.clientWidth ){
	            oBtn.style.left = (oWidth - oBtn.offsetWidth);
	            oTrack.style.width= (oWidth - oBtn.offsetWidth);
	            oIcon.style.display='none';
	            oSpinner.style.display='block';				
				flag=0;			
	        }else{
	            oBtn.style.left = 0;
	            oTrack.style.width= 0;
	        }
	        oBtn.className="button-on";
	        oTrack.className="track-on";       
	    },false);
 
    

		
		$('.travel-people-list span').click( function (){
			$(this).addClass('has-checked');
			$(this).siblings().removeClass('has-checked');
			$(this).children('img').attr('src','__PUBLIC__/phone/images/order_create/checked.png');
			$(this).siblings().children('img').attr('src','__PUBLIC__/phone/images/order_create/no_checked.png');
		} );
				
		
		// 计算总价
		function calcTotalMoney() {
			var adultCount = 0, childCount = 0;
			$('.change-people-num').each(function(i, ev){
				if ($(this).hasClass('child')) {
					childCount += parseInt($(this).find('span').html());
				} else {
					adultCount += parseInt($(this).find('span').html());
				}
			});
			
			var jsonData = {
				op_type: 'calc_money',
				batch_id: $('#batch_select').attr('data-id'),
				adult_count: adultCount,
				child_count: childCount,
			}
			
			$.post('{:U("line/order")}', jsonData, function(data){
				if (data.result.errno == 0) {
					if (data.batch != null && data.batch != 'undefined') {
						$('.price_adult').html('￥'+data.batch.price_adult+'/成人');
						$('.price_child').html('￥'+data.batch.price_child+'/儿童');
					}
					
					if (data.money != null && data.money != 'undefined') {
						$('.total_money').html(data.money.cut);
						$('.total_money').attr('data-no-cut',data.money.full);
					} else {				
						$('.total_money').html(0);
						$('.total_money').attr('data-no-cut',0);
					}
				} else {
					alert(data.result.message);
				}
			});			
		}
			
		// 添加筛选条件
		var prevSelect = {};
		function attachSelect(obj, title, data) {
			var ds = $.parseJSON(data);
			var ids = [], vals = [], invalids = [], uses = [];
			for (var i = 0; i < ds.length; i ++) {
				ids.push(ds[i].id);
				vals.push(ds[i].text);
				invalids.push(ds[i].invalid);
				uses.push(ds[i].use);
			}
			
			$(obj).picker({
				toolbarTemplate:'<header class="bar bar-nav">'+
								'	<button class="button button-link pull-right close-picker">确定</button>'+
								'	<h1 class="title">'+title+'</h1>'+
								'</header>',
				cols: [{
					textAlign:'center',
					values: vals,
				}],
				onOpen: function() {
					var itemsObj = $('.picker-item');
					for (var i = 0; i < $(ids).length; i++) {
						$(itemsObj[i]).attr('data-val', ids[i]);
						if ($(obj).hasClass('batch_select')) {
							$(itemsObj[i]).attr('data-invalid', invalids[i]);
							$(itemsObj[i]).attr('data-use', uses[i]);
						}
					}
					if ($(obj).hasClass('batch_select')) {
						prevSelect['id'] = $(obj).attr('data-id');
						prevSelect['value'] = $(obj).val();
					}
				},
				onClose: function(){
					if ($('.picker-selected').length > 0) {
						if ($(obj).hasClass('batch_select')) {
							if ($('.picker-selected').attr('data-invalid') == 1) {
								$(obj).attr('data-id', prevSelect.id);
								$(obj).val(prevSelect.value);
								$('.err_msg').html('该批次已过期报名时间，详情请咨询客服MM');
								return false;
							}
							if ($('.picker-selected').attr('data-use') == 0) {
								$(obj).attr('data-id', prevSelect.id);
								$(obj).val(prevSelect.value);
								$('.err_msg').html('该批次已被禁用或已经下架，详情请咨询客服MM');
								return false;
							}
							$('.err_msg').html('');
						}
						// 设置选中的编号
						var dataVal = $('.picker-selected').attr('data-val');
						$(obj).attr('data-id', dataVal);			
						// 特殊处理批次选择
						if ($(obj).hasClass('batch_select')) {
							var dates = $(obj).val().split('至');
							$('.cur_sel_batch').html('* '+dates[0]+'出发 , '+dates[1]+'返回');
							//  重新计算价格
							calcTotalMoney();
						}
					}
				}
			});			
		}
			
		// 批次选择
		attachSelect('#batch_select', '选择您的出发日期', '{$batch_list}');
		
		// 移除参团人信息
		$('.change-people-num a:first-child').click( function () {			
			//判断原本span中的值，小于0则不在计算
			if( parseInt($(this).next('span').html()) <= 0 ){
				return;
			}else {
				$(this).next('span').html( parseInt($(this).next('span').html()) - 1 );
				// 删除最后一个该类型的旅客信息
				var memberType = $(this).closest('.change-people-num').attr('data-type');
				$('.passenger-information').find('.'+memberType+':last').closest('.passenger-information-list').remove();
				// 刷新参团人编号
				$('.passenger-information-list').find('.sort').each(function(i, ev){
					$(this).html(i+1);	
				});
				// 重新核实总价
				calcTotalMoney();
			}
		} );
		
		// 添加参团人信息
		function appendMemberHtml(memberType) {
			//声明旅客人数
			var spanNum = $('.list-block').find('.passenger-information-list').length + 1;
			// 游客类型
			var mt = null;
			var memberTypes = $.parseJSON('{$member_types}');
			for (var i = 0; i < $(memberTypes).length; i ++) {
				var t = memberTypes[i];
				if (t.type_key == memberType) {
					mt = t;
				}
			}
			
			//添加
			var rootObj = $('.template_member').clone(true);
			$(rootObj).removeClass('template_member');
			$(rootObj).removeClass('hidden_ctrl');
			$(rootObj).find('.sort').html(spanNum);
			$(rootObj).find('.member_type').attr('data-id', mt.id);
			$(rootObj).find('.member_type').addClass(mt.type_key);
			$(rootObj).find('.member_type').html(mt.type_desc);
			$('.passenger-information .list-block').append(rootObj);
			
			// 旅客选择证件
			attachSelect($(rootObj).find('.cert'), '证件类型', '{$certs}');
			// 赠品初始化
			initLargessSelect($(rootObj).find('.largess'));
		}
		
		// 出游人数增加
		$('.change-people-num a:last-child').click( function () {			
			$(this).prev('span').html( parseInt($(this).prev('span').html()) + 1 );
			// 添加参团人
			var memberType = $(this).closest('.change-people-num').attr('data-type');
			appendMemberHtml(memberType);
			// 重新计算总价
			calcTotalMoney();
		} );


		//旅客选择证件（防止子页面刷新）
		attachSelect($('.passenger-information-list').find('.cert'), '证件类型', '{$certs}');
		
		// 赠品选择
		function initLargessSelect(largessObj) {
			var dataKey = $(largessObj).attr('data-key');
			var showDesc = $(largessObj).attr('data-desc');
			$.post('{:U("line/largess")}', {data_type:dataKey}, function(data){
				if(data.result.errno == 0 && data.ds != null) {
					attachSelect(largessObj, showDesc, JSON.stringify(data.ds));	
				} else {
					console.log(data.result.message);
				}
			});
		}
		
		// 
		$(document).ready(function(){						
			// 初始化赠品选择项			
			$('.passenger-information-list').find('.largess').each(function(i, ev){
				initLargessSelect(this);
			});		
		});
		
		// 联系人手机效验码验证
		var IntervalContactSend = 0, sub_send_second = 600, contact_phone='';
		$('#btnSendCode').click(function(data){			
			if ($(this).is(":disabled") == false) {
				contact_phone = $('#contact_phone').val();
				if (checkMobile(contact_phone) == false) {
					alert('电话号码有误');
					return false;
				}
				var jsonData = {
					type: 'send',
					tel: contact_phone,
					use: 'phone_order_contact_phone',
					interval: 600,
					rd: '{$pagerd}',
				};
				
				$.post('{:U("common/sms")}', jsonData, function(data){
					if (data.result.errno == 0) {
						sub_send_second = 600;
						$('#btnSendCode').val(sub_send_second+'秒后重新发送');
						$("#btnSendCode").attr("disabled", "disabled");
						IntervalContactSend = window.setInterval(refreshContactPhoneCode, 1000);
					} else {
						alert(data.result.message);
					}
				});
			} else {
				alert('验证码已经发送，请随后在此发送');
			}
		});
		
		// 刷新发送联系人手机验证码时间
		function refreshContactPhoneCode() {
			if (sub_send_second == 0) {
				window.clearInterval(IntervalContactSend);
				$('#btnSendCode').val('发送验证码');
				$('#btnSendCode').removeAttr('disabled');
			} else {
				sub_send_second--;
				$('#btnSendCode').val(sub_send_second+'秒后重新发送');
			}
		}
		
		
		// 更换联系人电话号码
		$('#contact_phone').blur(function(){
			var phone = $('#contact_phone').val();
			if (phone != contact_phone) {
				$('#contact_result').html('');
			}
		});
		
		// 验证联系人发送的验证码
		$('#contact_verify_code').blur(function(){
			if ($('#contact_result').html() != '') {
				return false;
			}
			var sCode = $(this).val();
			if (sCode == '') {
				alert('验证码不能为空');
				return false;
			}
			var phone = $('#contact_phone').val();
			if (checkMobile(phone) == false) {
				alert('验证码有误');
				return false;
			}
			var jsonData = {
				type: 'check',
				tel: phone,
				use: 'phone_order_contact_phone',
				code: sCode,
			};
			
			$.post('{:U("common/sms")}', jsonData, function(data){
				if (data.result.errno == 0) {
					$('#contact_result').html('验证通过');
					window.clearInterval(IntervalContactSend);
					$('#btnSendCode').val('发送验证码');
					$('#btnSendCode').removeAttr('disabled');
				} else {
					alert(data.result.message);
				}
			});
		});
		
		// 检查订单信息
		function checkOrder() {			
			// 联系人检查
			if ($('#contact_name').val() == '') {
				alert("联系人姓名不能为空");
				return false;
			}
			
			// 联系人手机确认
			if ('{$user.id}' == '') {
				if ($('#contact_result').html() != '验证通过') {
					alert("联系人手机未验证确认");
					return false;
				}	
			} else {
				if (checkMobile($('#contact_phone').val()) == false) {
					alert("联系人手机错误");
					return false;
				}
			}
			
			return true;
		}
		
		// 获取赠品信息
		function getLargessData(obj) {
			var largess = [];
			$(obj).find('.largess-item').each(function(i,ev){
				var l = {
					largess_id: $(this).attr('data-id'),
					data_id: $(this).find('.largess').attr('data-id'),
				};
				largess.push(l);
			});
			return largess;
		}
		
		
		// 获取参团人信息
		function getMemberData() {
			var jsonData = [];
			$('.list-block').find('.passenger-information-list').each(function(i, ev){
				var mobilePhone = $(this).find('.tel').val();
				if (mobilePhone != '' && (checkMobile(mobilePhone) == false || checkTel(mobilePhone) == false)) {
					var typeDesc = $(this).find('.member_type').html();
					alert('第'+i+'位'+typeDesc+'的电话号码错误！');
					return false;	
				}
				
				var obj = {
					name: $(this).find('.name').val(),
					type_id: $(this).find('.member_type').attr('data-id'),
					certificate_type_id: $(this).find('.cert').attr('data-id'),
					certificate_num: $(this).find('.cert_num').val(),
					tel: mobilePhone,
					largess: getLargessData($(this)),
				};
				jsonData.push(obj);
			});		
			return jsonData;
		}
		
		// 获取订单数据
		function getOrderData() {
//			var receiptType = $('.order-details-invoice').find('.order-details-invoice-choose').find('input:checked').val();
			var  manCount = $('.adult_man').find('span').html();
			var  womanCount = $('.adult_woman').find('span').html();
			var  childCount = $('.child').find('span').html();
			var receiptType = 0;
			
			var memberData = getMemberData();
			if (memberData === false) {
				return false;
			}
			
			var jsonData = {
				op_type: 'create',
				lineid: '{$line.id}',
				hdid: $('#batch_select').attr('data-id'),
				userid: '{$user.id}',
				duid: '{$duid}',
				male: manCount == '' || manCount == null ? 0 : manCount,
				woman: womanCount == '' || womanCount == null ? 0 : womanCount,
				child: childCount == '' || childCount == null ? 0 : childCount,
				types: '成人', //联系人类型
				names: $('#contact_name').val(), //联系人名称
				gendar: '男', // 联系人性别
				mob: $('#contact_phone').val(),
				members: memberData,
				oldman: $('.travel-people-information').find('.old-man').find('.has-checked').attr('data-id'),
				foreigner: $('.travel-people-information').find('.foreign-man').find('.has-checked').attr('data-id'),
				hk_mc: $('.travel-people-information').find('.gat-man').find('.has-checked').attr('data-id'),
				receipt_type: receiptType,
				book_account_type: '{$user.account_type.id}',
			}			
			jsonData['member_total_count'] = parseInt(jsonData['male']) + parseInt(jsonData['woman']) + parseInt(jsonData['child']);
			if ('{$user.id}' == '') {
				jsonData['mob_code'] = $('#contact_verify_code').val();
			}
			
//			if (receiptType != 0) {
//				var parentClass = receiptType == 1 ? '.order-details-invoice-write-enterprise' : '.order-details-invoice-write-personal';
//				if (receiptType == 1) {
//					jsonData['receipt_company'] = $(parentClass).find('.receipt_company').val();
//					jsonData['receipt_company_no'] = $(parentClass).find('.receipt_company_no').val();
//					jsonData['receipt_company_address'] = $(parentClass).find('.receipt_company_addr').val();
//					jsonData['receipt_company_phone'] = $(parentClass).find('.receipt_company_tel').val();
//				}
//				jsonData['receipt_receiver'] = $(parentClass).find('.receipt_receiver').val();
//				jsonData['receipt_receiver_phone'] = $(parentClass).find('.receipt_receiver_tel').val();
//				jsonData['receipt_receiver_address'] = $(parentClass).find('.receipt_receiver_addr').val();
//			}
			return jsonData;
		}		
		
		// 下单
		$('#comfirm_order').click(function(){
			if (checkOrder() == false) {
				return false;
			}
			//判断验证码滑动成功
			if (flag != 0){
				alert('请滑动验证码');
				return false;
			}
			
			var jsonData = getOrderData();	
			if (jsonData === false) {
				return false;
			}
			
			if (parseInt(jsonData['member_total_count']) == 0) {
				alert('出游人数总和不能为0');
				return false;
			}
			
			console.log(JSON.stringify(jsonData));
			ShowMark();
			$.post('{:U("line/order")}', jsonData, function(data){
				HideMark();
				if (data.result.errno != 0) {
					alert(data.result.message);
				}
				if (data.jumpUrl != null && data.jumpUrl != 'undefined') {
					location.href = data.jumpUrl;
				}
			});
		});
	})
</script>
<include file="common/swt" />
	</body>
</html>