<include file="Common/header" />
<style>
	.form-control { width: 30%; }
	.form-control:focus { border-color: #40bbea; }
	.chaxun { margin-right: 100px; margin-bottom: 30px; }
	#cash_useSelectBoxIt, #cash_funcSelectBoxIt, #review_typeSelectBoxIt { 
		border-radius: 0 15px 15px 0 ; 
		background-color: #fff; 
		border-color: #40bbea; 
		overflow: hidden; 
	}
	
	.selectboxit-options { 
		border-radius: 0 15px 15px 15px; 
		background-color: #fff; 
		border-color: #40bbea; 
	}
	
	.selectboxit-options li a { color: #000; }

	.selectboxit-option-icon-container { overflow: hidden; }
	.cx_border01 { border-radius: 15px 0 0 15px; border-color: #40bbea; }
	.cx_border02 , html .select2-container .select2-choice , #s2id_activity{ border-radius: 0 15px 15px 0 !important; border-color: #40bbea !important; }
	.tab-pane > div { margin-top: 10px; height: 35px; }
	.ctr_card_btn_num:focus { border-color: #40bbea; }
	.dropdown-menu.dropdown-info > li > a { color: #000; }
	.dropdown-menu.dropdown-info > li > a:hover { background-color: #999 !important; }
	.nav.nav-tabs > li.active > a { border: 1px solid #40bbea; border-bottom: 2px solid #fff; }
	.nav.nav-tabs > li > a { padding-left: 30px; padding-right: 30px; }
	.nav.nav-tabs > li > a:hover { background-color: #40bbea; color: #fff; }
	.hvr-curl-top-left {
	  display: inline-block;
	  vertical-align: middle;
	  -webkit-transform: translateZ(0);
	  transform: translateZ(0);
	  box-shadow: 0 0 1px rgba(0, 0, 0, 0);
	  -webkit-backface-visibility: hidden;
	  backface-visibility: hidden;
	  -moz-osx-font-smoothing: grayscale;
	  position: relative;
	}
	.hvr-curl-top-left:before {
	  pointer-events: none;
	  position: absolute;
	  content: '';
	  height: 0;
	  width: 0;
	  top: 0;
	  left: 0;
	  background: white;
	  /* IE9 */
	  background: linear-gradient(135deg, white 45%, #aaaaaa 50%, #cccccc 56%, white 80%);
	  filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#ffffff', endColorstr='#000000');
	  /*For IE7-8-9*/
	  z-index: 1000;
	  box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.4);
	  -webkit-transition-duration: 0.3s;
	  transition-duration: 0.3s;
	  -webkit-transition-property: width, height;
	  transition-property: width, height;
	}
	.hvr-curl-top-left:hover:before, .hvr-curl-top-left:focus:before {
	  width: 15px;
	  height: 15px;
	}
	.info-color { background-color: #40bbea !important; border-color: #40bbea !important; }
	.info-border-color { border-color: #40bbea !important; }
	.select2-arrow { color: #fff !important; }
	#select2-drop { border-color: #40bbea;  } 
	
	.selectboxit-container .selectboxit { border-radius: 0 15px 15px 0 !important; }             
	.selectboxit-arrow-container { background-color: #40bbea; }
	.selectboxit-arrow-container i { color: #fff; }
	#activitySelectBoxIt , #sboxit-5SelectBoxIt , #order_fromSelectBoxIt , #order_stateSelectBoxIt , #sboxit-8SelectBoxIt { border-radius: 0 15px 15px 0 ; background-color: #fff; border-color: #40bbea; overflow: hidden; }
	#activitySelectBoxItOptions , #sboxit-5SelectBoxItOptions , #order_fromSelectBoxItOptions , #order_stateSelectBoxItOptions , #sboxit-8SelectBoxItOptions , #cash_funcSelectBoxItOptions { border-radius: 0 15px 15px 15px; background-color: #fff; border-color: #40bbea; }
	#activitySelectBoxItOptions li a , #sboxit-5SelectBoxItOptions li a , #order_fromSelectBoxItOptions li a ,  #sboxit-8SelectBoxItOptions li a , #cash_funcSelectBoxItOptions li a , .selectboxit-list li a{ color: #000; }	
	.selectboxit-list .selectboxit-option-anchor{color:#000;}
	
	.background-color-first-log { background-color:#eae415 !important; }
</style>
	<div class="row">
		<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">{:C('CONTENT_TITLE')}</h3>			
			<div class="panel-options">
				<a href="#" data-toggle="panel">
					<span class="collapse-icon">&ndash;</span>
					<span class="expand-icon">+</span>
				</a>
			</div>
		</div>
		
		<div class="panel-body">			
			<div role="form" class="form-horizontal" style="margin: 20px auto; padding-left: 50px;">
				<div class="form-group">
					<select class="col-sm-1 date_type" style="height: 32px; border: 1px solid #eee;">
						<option value="request" selected>请求日期</option>
						<option value="review">审核日期</option>
						<option value="confirm">确认日期</option>
					</select>
					<div class="col-sm-4">
						<input type="text" class="form-control search_date daterange" style="width: 100%;" data-separator=" / " data-format="YYYY-MM-DD" placeholder="请选择日期" readonly />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-1 control-label" for="search_input" style="text-align: left; padding-bottom: 7px; background-color: #eee;" >搜索内容</label>
					<div class="col-sm-8">
						<input type="text" class="form-control search_input" style="width: 100%;" placeholder="搜索内容可以是审核编号、团期编号、提审人员、审批人员、确认人员、收款人、收款账号、开户行地址,另外您可以在输入搜索内容后肆无忌惮的敲下回车键进行搜索...祝您查找愉快!!!">
					</div>
				</div>
				<div class="form-group">
					<button class="btn btn-secondary search_button">开始搜索</button>
					<button class="btn btn-secondary search_reset">重置搜索</button>
				</div>
			</div>

			<table class="table table-bordered table-striped" id="example-1">
				<thead>
					<tr>
						<th>审核编号</th>
						<th>团期</th>
						<th>送审对象</th>
						<th>操作方式</th>
						<th>提审内容</th>
						<th>提审人员</th>
						<th>提审时间</th>
						<th>审核状态</th>
						<th>审核人员</th>
						<th>审核时间</th>
						<th>审核操作</th>
					</tr>
				</thead>
			</table>				
					
		</div>
	</div>
</div>	
<include file="Common/footer" />


<script type="text/javascript">
	
	var myTable = null;
	$(document).ready(function(){		
		// 初始化数据表格
		myTable = initDataTable();
		console.log(myTable);
		// 搜索
		$(".search_button").click(findDeposit);	
		// 重置搜索条件
		$('.search_reset').click(resetDeposit);
		// 绑定快捷查找
		bindKeyUp($('html,body'),findDeposit,1);
	});
	
	// 查找数据
	function findDeposit() {
		console.log(myTable);
		if (myTable != null) {
	   		myTable.fnReloadAjax(myTable.fnSettings());	
		}
	}
	
	// 重置查询条件
	function resetDeposit(ev) {
		$('.search_input').val('');
		$('.date_type').val('request');
		$('.search_date').val('');
		return false;
	}
	
	// 初始化数据列表
	function initDataTable() {	
		var vTable = $("#example-1").dataTable({
			"bSort": true,
			"bAutoWidth": true,
			"bFilter": true,
			"searching": false,
			"bInfo": true,//页脚信息
			"bPaginate": true, //翻页功能
			"bLengthChange": true, //改变每页显示数据数量
			"bStateSave": true,	//状态保存，使用了翻页或者改变了每页显示数据数量，会保存在cookie中，下回访问时会显示上一次关闭页面时的内容。
			"sPaginationType": "full_numbers", //显示数字的翻页样式"
			"aLengthMenu": [[50, 100, 200],[50, 100, 200]],	// 可分页的数量值与显示
			"isDisplayLength": 50,	// 当前每页显示数量
			"oLanguage": {
				"sLengthMenu": "每页显示 _MENU_ 条记录",
				"sZeroRecords": "抱歉， 没有找到",
				"sInfo": "从 _START_ 到 _END_ / 共 _TOTAL_ 条数据",
				"sInfoEmpty": "没有数据",
				"sInfoFiltered": "(从_MAX_条数据中检索)",
				"oPaginate": {
					"sFirst": "首页",
					"sPrevious": "前一页",
					"sNext": "后一页",
					"sLast": "尾页"
				},
				"sZeroRecords": "没有检索到数据",
				"sProcessing": "<src='__PUBLIC__/images/loader.gif' />",
			},
			//Ajax获取信息
			"bProcessing": true,
			"bServerSide": true,
			"sAjaxSource": '{:U("financial/deposit")}',
			//如果加上下面这段内容，则使用post方式传递数据
			"fnServerData": getPageData,
			"aoColumns": [
				{"mData": "id", "aTargets": [0], "fnCreatedCell": replaceContent},
				{"mData": "team_id", "aTargets": [1], "fnCreatedCell": replaceContent},
				{"mData": "deposit_obj", "aTargets": [2], "fnCreatedCell": replaceContent},
				{"mData": "depoist_type", "aTargets": [3], "fnCreatedCell": replaceContent},
				{"mData": "request_content", "aTargets": [4], "fnCreatedCell": replaceContent},
				{"mData": "request_admin", "aTargets": [5], "fnCreatedCell": replaceContent},
				{"mData": "request_time", "aTargets": [6], "fnCreatedCell": replaceContent},
				{"mData": "review_type", "aTargets": [7], "fnCreatedCell": replaceContent},
				{"mData": "review_admin", "aTargets": [8], "fnCreatedCell": replaceContent},
				{"mData": "review_time", "aTargets": [9], "fnCreatedCell": replaceContent},
				{"bSortable": false, "mDataProp":"id", "bSearchable": false, "aTargets": [10], "fnCreatedCell": appendLastCol},
			],//$_GET[‘sColumns’]将接收到aoColumns传递数据
			"aoColumnDefs": [{"sDefaultContent": "", "aTargets": ["_all"]}],
		});
		return vTable;
	}

	//Ajax获取数据
	function getPageData ( sSource, aoData, fnCallback ) {
		showLoading(true);
		aoData.push({'name':'op_type','value':'list'});
		aoData.push({'name':'cds', 'value':$('.search_input').val()});
		aoData.push({'name':'date_type', 'value':$('.date_type').val()});
		aoData.push({'name':'daterange', 'value':$('.search_date').val()});
		$.post('{:U("financial/deposit")}', aoData, function(data){
			showLoading(false);
			if (data['result']['errno'] == 0) {
				fnCallback(data);
			} else {
				alert(data['result']['message']);
			}
		})
	}
	
	// 内容替换
	function replaceContent(nTd, sData, oData, iRow, iCol) {
		if (oData.review_type_data != null) {
			if (oData.review_type_data.type_key == 'review_pass'){
				$(nTd).css('backgroundColor', '#C1CB01');
			}
			if (oData.review_type_data.type_key == 'reviewing' || oData.review_type_data.type_key == 'review_confirm_fail'){
				$(nTd).css('backgroundColor', '#2eb12e');
			}
		}
		if (iCol == 0) {
			$(nTd).html(oData.id);	
		} else if (iCol == 1) {
			var teamCode = oData.team_data != null ? oData.team_data.team_code : '非团期内请款';
			$(nTd).html(teamCode);
		} else if (iCol == 2) {
			var depositObjContent = oData.deposit_obj_data != null ? oData.deposit_obj_data.type_desc : '';
			$(nTd).html(depositObjContent+'<br />'+oData.deposit_obj_show);
		} else if (iCol == 3) {
			var depositTypeContent = oData.deposit_type_data != null ? oData.deposit_type_data.type_desc : '';
			if (oData.deposit_type != null && oData.deposit_type.indexOf('支付资金') == -1) {
				$(nTd).css('backgroundColor', '#c98d85');
			}
			$(nTd).html(depositTypeContent);
		} else if (iCol == 4) {
			$(nTd).html(oData.money);
		} else if (iCol == 5) {
			var requestAdmin = oData.request_admin_data != null ? oData.request_admin_data.account : '';
			$(nTd).html(requestAdmin);
		} else if (iCol == 6) {
			$(nTd).html(oData.request_time);
		} else if (iCol == 7) {
			var reviewTypeContent = oData.review_type_data != null ? oData.review_type_data.type_desc : '';
			$(nTd).html(reviewTypeContent);	
		} else if (iCol == 8) {
			var reviewAdmin = oData.review_admin_data != null ? oData.review_admin_data.account : '';
			$(nTd).html(reviewAdmin);	
		} else if (iCol == 9) {
			$(nTd).html(oData.review_time);	
		}
	}

	// 添加最后一列控件
	function appendLastCol(nTd, sData, oData, iRow, iCol) {
//		alert(nTd+'|'+JSON.stringify(sData)+'|'+JSON.stringify(oData)+'|'+iRow+'|'+iCol);  
		var id = parseInt(oData['id']);
		if (oData['team_id'] == null || oData['team_id'] == '') {
			$(nTd).html('<a href="'+'{:U("financial/deposit")}/op/new/id/'+id+'" class="btn btn-secondary btn-sm btn-icon icon-left" target="_blank">查看请款</a>');
		}
		$(nTd).html('<a href="'+'{:U("financial/deposit")}/id/'+id+'" class="btn btn-secondary btn-sm btn-icon icon-left" target="_blank">审批详细</a>');
	}

	/*
	add this plug in
	// you can call the below function to reload the table with current state
	Datatables刷新方法
	oTable.fnReloadAjax(oTable.fnSettings());
	*/
	$.fn.dataTableExt.oApi.fnReloadAjax = function (oSettings) {
		//oSettings.sAjaxSource = sNewSource;
		this.fnClearTable(this);
		this.oApi._fnProcessingDisplay(oSettings, true);
		var that = this;

		$.getJSON(oSettings.sAjaxSource, null, function (json) {
		    /* Got the data - add it to the table */
		    for (var i = 0; i < json.aaData.length; i++) {
		        that.oApi._fnAddData(oSettings, json.aaData[i]);
		    }
		    oSettings.aiDisplay = oSettings.aiDisplayMaster.slice();
		    that.fnDraw(that);
		    that.oApi._fnProcessingDisplay(oSettings, false);
		});
	}

</script>
	