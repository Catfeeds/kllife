<include file="Common/header" />
	<style>
		.selectboxit-btn { background: #fff; border-color: #40bbea; }
		.selectboxit-list { background-color: #fff; border: 1px solid #40bbea; }
		.selectboxit-list .selectboxit-option-anchor { color: #979898; }
		.form-control:focus { border-color: #40bbea; }
		a { color: #979898; }
		.dingdan_bianji { border: 1px solid #40bbea; }
		.dingdan_bottom > p , .dingdan_bottom > span{ margin-top: 7px; }
		.add_xingming , .add_shouji , .add_card_btn_num { border: 1px solid #40bbea; }
		.add_xingming , .add_shouji { outline: none; }
		.add_xingming:focus , .add_shouji:focus { border: 1px solid #40bbea; }
		.dingdan_bottom { margin-bottom: 10px; }
		.cx_border02 , html .select2-container .select2-choice , #s2id_activity{ border-color: #40bbea !important; }
		.info-color { border-color: #40bbea !important; }
		#select2-drop { border-color: #40bbea;  } 
		#order_fromSelectBoxItContainer {
			vertical-align: middle;
		}
		
		#add_member_typeSelectBoxItContainer { width:196px !important; display:inline-block !important; vertical-align: middle;}
		.cx_border02 , .select2-container , .select2-choice , .info-border-color{ border-color: #40bbea !important; }
		
		.my_spinner_input {
			border: 1px solid #40bbea;
			padding: 0px 14px !important;
			height: 32px !important;
		}
		
		.my_spinner_button {
			padding: 0px 14px !important;
			height: 32px !important;
		}
		
	</style>
	<div class="row">	
		<div class="col-sm-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"> 
						{:C('CONTENT_TITLE')}
					</h3>
				</div>
				<div class="panel-body row">
					<div id="dingdan_main" class="col-sm-12" style="margin-left: 5%;">
						<div class="row">
							<div class="form-group row">
								<p id='err_msg' class="col-sm-3" style="color:#e4393c;"></p>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">图片标题：</p>
								<input id='img_title' type="text" style="height: 32px;" class="dingdan_bianji col-sm-6">
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">图片作者：</p>
								<input id='img_author' type="text" style="height: 32px;" class="dingdan_bianji col-sm-6">
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">图片描述：</p>
								<input id='img_intro' type="text" style="height: 32px;" class="dingdan_bianji col-sm-10">
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">图片类型：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea; float:left; margin-right:3px;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_type_obj = $("#image_type").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_type_obj).find('option:first').attr('value');									
											$(image_type_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_type" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgType" name="ImageTypes">
											<option value="{$imgType.id}">{$imgType.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">图片来源：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea; float:left; margin-right:3px;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_from_obj = $("#image_from").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_from_obj).find('option:first').attr('value');									
											$(image_from_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_from" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgFrom" name="ImageFroms">
											<option value="{$imgFrom.id}">{$imgFrom.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">内容类型：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea; float:left; margin-right:3px;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_content_obj = $("#image_content").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_content_obj).find('option:first').attr('value');									
											$(image_content_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_content" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgContent" name="ImageContents">
											<option value="{$imgContent.id}">{$imgContent.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">地域类型：</p>
								<div class="input-group col-sm-6" style="border-color: #40bbea; float:left; margin-right:3px;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_domain_obj = $("#image_domain").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_domain_obj).find('option:first').attr('value');									
											$(image_domain_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_domain" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgDomain" name="ImageContents">
											<option value="{$imgDomain.id}">{$imgDomain.type_desc}</option>
										</volist>
									</select>
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_content_obj = $("#image_content").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_content_obj).find('option:first').attr('value');									
											$(image_content_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_content" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgContent" name="ImageContents">
											<option value="{$imgContent.id}">{$imgContent.type_desc}</option>
										</volist>
									</select>
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var image_content_obj = $("#image_content").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});	
											var initVal = $(image_content_obj).find('option:first').attr('value');									
											$(image_content_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="image_content" class="form-control">
										<option value="-1">不限</option>
										<volist id="imgContent" name="ImageContents">
											<option value="{$imgContent.id}">{$imgContent.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							
						</div>
						<br />
						<br />
						<if condition="empty($task)">
							<button id="create_task" class="btn btn-info">生成任务</button>	
						<else />
							<button id="create_task" class="btn btn-info">保存任务</button>	
						</if>
						<button id="back_list" class="btn btn-secondary">返回列表</button>						
					</div>
				</div>
			</div>
		</div>
	</div>
<include file="Common/footer" />

<script type="text/javascript">
	$(document).ready(function(){
		
		// 创建订单
		$('#create_task').click(createTask);
		
		// 返回列表
		$('#back_list').click(function(){window.history.back(-1);})
	});
		
	
	function checkCreateData(jsonData) {
//		console.log(JSON.stringify(jsonData));
		if (jsonData.name == '') {
			alert('任务名称不能为空');
			return false;
		}
		
		return true;
	}
	
	// 创建订单
	function createTask() {		
		var jsonData = {
			'op_type': '{:empty($task)?"create":"edit"}',
			'task_id': $('#task_id').val(),
			'name': $('#task_name').val(),
			'desc': $('#task_desc').val(),
			'notify_start_type': $('#start_date').val(),
			'start_date_offset': $('#start_date_offset').val(),
			'notify_end_type': $('#end_date').val(),
			'end_date_offset': $('#end_date_offset').val(),
			'holiday_offset': $('#holiday_offset').val(),
		}		
		
//		console.log(JSON.stringify(jsonData));
		if (checkCreateData(jsonData) == false) {
			return false;
		}
		
		showLoading(true)
		$.post('{$ajaxRequestUrl}', jsonData, function(data){
//			console.log(JSON.stringify(jsonData));
			if (data.result.errno == 0) {
				alert(data.result.message);
				location.href = '{$ajaxResponseUrl}';
			} else {
//				$('#err_msg').html(data.result.message);
				alert(data.result.message);
			}
			showLoading(false)
		});
	}
</script>