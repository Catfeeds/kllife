<include file="Common/header" />
	<style>
		.cantuanrenshu span { margin-right: 1%; }
		.ctr_xinxi label { margin-left: 2%; color: #fff; }
		.ctr_top { margin-left: .1%; margin-top: 1%; background: #999; }
		.ctr_top p { color: #fff; }
		.ctr_input , .ctr_select { height: 32px; padding: 6px 12px; color: #000; }
		.ctr_select { vertical-align: bottom; margin-left: -4px; }
		#table td { vertical-align: middle; }
		.ctr_xingming , .ctr_shouji { width: 80%; height: 32px; padding: 6px 12px; border: 1px solid #40bbea; display: none; }
		.ctr_baocun , .ctr_sex , .ctr_card { display: none; }
		#table .ctr_card_num { float: right; width: 60%; height: 32px; margin-right: 39px; padding: 6px 12px; border: 1px solid #40bbea; display: none; }
		.selectboxit-btn { background: #fff; border-color: #40bbea; }
		.selectboxit-list { background-color: #fff; border: 1px solid #40bbea; }
		.selectboxit-list .selectboxit-option-anchor { color: #979898; }
		.form-control:focus { border-color: #40bbea; }
		a { color: #979898; }
		.add_xinxi { display: none; }
		.dingdan_bianji , .dingdan_bianji01 , .dingdan_bianji02 { border: 1px solid #40bbea; }
		.dingdan_bottom > p , .dingdan_bottom span{ margin-top: 7px; }
		.add_xingming , .add_shouji , .add_card_btn_num { border: 1px solid #40bbea; }
		.add_xingming , .add_shouji { outline: none; }
		.add_xingming:focus , .add_shouji:focus { border: 1px solid #40bbea; }
		.dingdan_bottom { margin-bottom: 10px; }
		.cx_border02 , html .select2-container .select2-choice , #s2id_activity{ border-color: #40bbea !important; }
		.info-color { border-color: #40bbea !important; }
		#select2-drop { border-color: #40bbea;  } 
		#order_fromSelectBoxItContainer {
			vertical-align: middle;
		}
		
	</style>
	<div class="row">
		<div class="col-sm-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"> 
						{:C('CONTENT_TITLE')}
						<input id="order_id" type="hidden" value="{$order.id}"/>
					</h3>
				</div>
				<div class="panel-body row">
					<div id="dingdan_main" class="col-sm-12" style="margin-left: 5%;">
						<div class="row">
							<div class="form-group row">
								<p id='err_msg' class="col-sm-3" style="color:#e4393c;"></p>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">想去的景点：</p>
								<input id='destination' type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*景点不能为空</p>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">出行人数：</p>
								<input id='member_count' type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*出行人数不能为空或者小于1人</p>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系人：</p>
								<input id='linkman' type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*联系人不能空</p>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系人电话：</p>
								<input id="tel" type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*联系电话不能为空</p>
							</div>	
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">微信：</p>
								<input id="weixin" type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
							</div>	
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系QQ：</p>
								<input id="qq" type="text" style="height: 32px;" class="dingdan_bianji col-sm-3">
							</div>	
													
							<div class="row dingdan_bottom">
								<p class="cantuanrenshu col-sm-1">出行日期：</p>
								<input id="start_date" type="text" maxlength="11" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*出行日期不能为空</p>						
								<!--<div class="input-group col-sm-3" style="border-color: #40bbea;">									
									<input type="text" id="start_date" readonly class="form-control datepicker" data-start-date="0d" data-format="yyyy-mm-dd" />											
									<div class="input-group-addon">
										<a href="#"><i class="linecons-calendar"></i></a>
									</div>								
								</div>-->								
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">游玩天数：</p>
								<input id="days" type="text" maxlength="63" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<p style="color: red;">&nbsp;&nbsp;*游玩天数不能为空或小于1天</p>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">包团来源：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#team_from").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="team_from" class="form-control">
										<volist id="from" name="teamFrom">
											<option value="{$from.id}">{$from.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">处理结果：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											var team_result_obj = $("#team_result").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											})
												
											var initVal = $(team_result_obj).find('option:first').attr('value');						
											$(team_result_obj).val(initVal).trigger('change');
										});
									</script>
									<select id="team_result" class="form-control">
										<volist id="result" name="teamResult">
											<option value="{$result.id}">{$result.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">住宿酒店条件：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#hotel_request").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="hotel_request" class="form-control">
										<volist id="hotel" name="hotelRequest">
											<option value="{$hotel.id}">{$hotel.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">领队要求：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#leader_request").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="leader_request" class="form-control">
										<volist id="leader" name="leaderRequest">
											<option value="{$leader.id}">{$leader.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<!--<div class="row form-group">
								<p class="col-sm-1">车辆要求：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#car_request").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
//											    //Calls the selectBoxIt method on your HTML select box
//											    var selectBox = $(this).data("selectBoxSelectBoxIt");
//
//											    // Writes the showFirstOption option to the console
//											    console.log(selectBoxIt.option("showFirstOption"));
											});
										});
									</script>
									<select id="car_request" class="form-control">
										<volist id="car" name="carRequest">
											<option value="{$car.id}">{$car.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>-->
							
							<div class="row form-group">
								<p class="col-sm-1">特色服务：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#especial_request").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="especial_request" class="form-control">
										<volist id="especial" name="especialRequest">
											<option value="{$especial.id}">{$especial.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">联系时间：</p>
								<div class="input-group col-sm-3" style="border-color: #40bbea;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#contact_request").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="contact_request" class="form-control">
										<volist id="contact" name="contactRequest">
											<option value="{$contact.id}">{$contact.type_desc}</option>
										</volist>
									</select>
								</div>
							</div>
							<div class="form-group row">
								<p class="col-sm-1">其他联系方式：</p>
								<input id='contact_other' type="text" style="height: 32px;" class="dingdan_bianji col-sm-8">
							</div>		
							<div class="form-group row">
								<p class="col-sm-1">其他需求：</p>
								<textarea id="request_other" class="dingdan_bianji col-sm-8"></textarea>
							</div>
						</div>
						<br />
						<br />
						<button id="create_team" class="btn btn-info">生成包团信息</button>	
						<button id="back_list" class="btn btn-secondary">返回列表</button>						
					</div>
				</div>
			</div>
		</div>
	</div>
	<style type="text/css">
		#add_member_typeSelectBoxItContainer { width:196px !important; display:inline-block !important; vertical-align: middle;}
		.cx_border02 , .select2-container , .select2-choice , .info-border-color{ border-color: #40bbea !important; }
	</style>
<include file="Common/footer" />
<script type="text/javascript">
	$(document).ready(function(){
		// 检测联系人
		$('#tel').keyup(inputIntCheck);
		
		// 检测联系QQ
		$('#qq').keyup(inputIntCheck);
		
		// 创建订单
		$('#create_team').click(createTeamGroup);
		
		// 返回列表
		$('#back_list').click(function(){window.history.back(-1);})
	});
		
	// 数字检测
	function inputIntCheck() {
		var val = $(this).val();
	    if('' != val.replace(/\d{1,}\.{0,1}\d{0,}/,''))
	    {
	        var str = val.match(/\d{1,}\.{0,1}\d{0,}/) == null ? '' : val.match(/\d{1,}\.{0,1}\d{0,}/);
	        $(this).val(str);
	    }
	}
	
	function checkCreateData(jsonData) {
//		console.log(JSON.stringify(jsonData));
		if (jsonData.destination == '') {
			alert('目的地不能为空');
			return false;
		}
				
		if (parseInt(jsonData.member_count) < 1) {
			alert('参团人太少了，不能成团哦^_^');
			return false;
		}		
		
		if (jsonData.linkman == '') {
			alert('联系人不能为空');
			return false;
		}
		
		if (checkMobile(jsonData.tel) == false && checkTel(jsonData.tel) == false) {
			if (!confirm('手机或者座机号码格式有误，您确定继续添加')) {
				return false;	
			}
		}
		
		if (jsonData.start_date == '') {
			alert('出团日期不能为空');
			return false;
		}
						
		if (jsonData.days == '' || parseInt(jsonData.days) < 1) {
			alert('游玩天数不能小于1');
			return false;
		}
		
		if (jsonData.hotel_request == '' || jsonData.leader_request == '' || jsonData.car_request == '' || jsonData.especial_request == '' || jsonData.contact_time == '') {
			alert('参团成员类型数量不能为空');
			return false;
		}	
		
		return true;
	}
	
	// 创建订单
	function createTeamGroup() {		
		var jsonData = {
			'op': 'create_team',
			'destination': $('#destination').val(),
			'member_count': $('#member_count').val(),
			'linkman': $('#linkman').val(),
			'tel': $('#tel').val(),
			'weixin':$('#weixin').val(),
			'qq':$('#qq').val(),
			'start_date': $('#start_date').val(),
			'days': $('#days').val(),
			'hotel_request': $('#hotel_request').val(),
			'leader_request': $('#leader_request').val(),
//			'car_request': $('#car_request').val(),
			'especial_request': $('#especial_request').val(),
			'contact_time': $('#contact_request').val(),
			'from_id': $('#team_from').val(),
			'other_request': $('#request_other').val(),
			'other_contact': $('#contact_other').val(),
			'team_result': $('#team_result').val(),
		}
				
//		console.log(JSON.stringify(jsonData));
		if (checkCreateData(jsonData) == false) {
			return false;
		}
		
		showLoading(true)
		$.post('{:U("team/create")}', jsonData, function(data){
//			console.log(JSON.stringify(jsonData));
			if (data.result.errno == 0) {
				alert(data.result.message);
				location.href = '{:U("team/list")}';
			} else {
//				$('#err_msg').html(data.result.message);
				alert(data.result.message);
			}
			showLoading(false)
		});
	}
</script>