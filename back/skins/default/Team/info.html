<include file="Common/header" />
	<style>
		.cantuanrenshu span { margin-right: 1%; }
		.ctr_xinxi label { margin-left: 2%; color: #fff; }
		.ctr_top { margin-left: .1%; margin-top: 1%; background: #999; }
		.ctr_top p { color: #fff; }
		.ctr_input , .ctr_select { height: 32px; padding: 6px 12px; color: #000; }
		.ctr_select { vertical-align: bottom; margin-left: -4px; }
		#table td { vertical-align: middle; }
		.ctr_xingming , .ctr_shouji { width: 80%; height: 32px; padding: 6px 12px; border: 1px solid #40bbea; display: none; }
		.ctr_baocun , .ctr_sex , .ctr_card { display: none; }
		#table .ctr_card_num { float: right; width: 60%; height: 32px; margin-right: 39px; padding: 6px 12px; border: 1px solid #40bbea; display: none; }
		.selectboxit-btn { background: #fff; border-color: #40bbea; }
		.selectboxit-list { background-color: #fff; border: 1px solid #40bbea; }
		.selectboxit-list .selectboxit-option-anchor { color: #979898; }
		.form-control:focus { border-color: #40bbea; }
		a { color: #979898; }
		.dingdan_bianji { display: none; }
		.dingdan_bottom > p , .dingdan_bottom span{ margin-top: 7px; }
		.add_xingming , .add_shouji , .add_card_btn_num { border: 1px solid #40bbea; }
		.add_xingming , .add_shouji { outline: none; }
		.add_xingming:focus , .add_shouji:focus { border: 1px solid #40bbea; }
		.dingdan_bottom { margin-bottom: 10px; }
		.cx_border02 , html .select2-container .select2-choice , #s2id_activity{ border-color: #40bbea !important; }
		.info-color { border-color: #40bbea !important; }
		#select2-drop { border-color: #40bbea;  } 
		#order_fromSelectBoxItContainer {
			vertical-align: middle;
		}
		.selectboxit-container span {height: 32px; line-height: 32px;}
		.btn_cancel { display: none; }		
	</style>
	<div class="row">
		<div class="col-sm-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"> 
						{:C('CONTENT_TITLE')}
						<input id="team_id" type="hidden" value="{$team.id}"/>
					</h3>
				</div>
				<div class="panel-body row">
					<div id="dingdan_main" class="col-sm-12" style="margin-left: 5%;">
						<div class="row">
							<div class="form-group row">
								<p id='err_msg' class="col-sm-3" style="color:#e4393c;"></p>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">想去的景点：</p>
								<span id="destination_show" class="col-sm-3" style="padding-left: 0;">{$team.destination}</span>
								<input type="text" id="destination_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="destination" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="destination" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">出行人数：</p>
								<span id="member_count_show" class="col-sm-3" style="padding-left: 0;">{$team.member_count}</span>
								<input type="text" id="member_count_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="member_count" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="member_count" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系人：</p>
								<span id="linkman_show" class="col-sm-3" style="padding-left: 0;">{$team.linkman}</span>
								<input type="text" id="linkman_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="linkman" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="linkman" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系人电话：</p>
								<span id="tel_show" class="col-sm-3" style="padding-left: 0;">{$team.tel}</span>
								<input type="text" id="tel_val" maxlength="11" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="tel" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="tel" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">微信：</p>
								<span id="weixin_show" class="col-sm-3" style="padding-left: 0;">{$team.weixin}</span>
								<input type="text" id="weixin_val" maxlength="31" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="weixin" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="weixin" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>	
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">联系人QQ：</p>
								<span id="qq_show" class="col-sm-3" style="padding-left: 0;">{$team.qq}</span>
								<input type="text" id="qq_val" maxlength="11" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="qq" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="qq" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>	
													
							<div class="row dingdan_bottom">
								<p class="cantuanrenshu col-sm-1">出行日期：</p>
								<span id="start_date_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.start_date}</span>		
								<input type="text" id="start_date_val" style="height: 32px;" class="dingdan_bianji col-sm-6">
								<!--<div id="start_date_container" class=" col-sm-3 dingdan_bianji date form_datetime" style="border-color: #40bbea; float: left;" data-date="" data-date-format="yyyy-mm-dd hh:ii:ss" data-link-field="start_date_val">
								    <input id="start_date_val" size="16" type="text" value="" readonly>
									<span class="add-on"><i class="icon-th"></i></span>
								</div>				
								<script type="text/javascript">
									$(document).ready(function(){
									    $("#start_date_container").datetimepicker({
									        language:  'zh-CN',
									        weekStart: 1,
									        todayBtn:  1,
											autoclose: 1,
											todayHighlight: 1,
											startView: 2,
											forceParse: 0,
									    });
									});
								</script>-->
								<if condition="$grant_update_team eq true">
									<input type="button" name="start_date" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="start_date" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>						
							</div>
							
							<div class="row dingdan_bottom">
								<p class="col-sm-1">游玩天数：</p>
								<span id="days_show" class="col-sm-3" style="padding-left: 0;">{$team.days}天</span>
								<input type="text" id="days_val" maxlength="63" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="days" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="days" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">包团来源：</p>
								<span id="from_id_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.from_id_type_desc}</span>
								<div id="from_id_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#from_id_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="from_id_val" class="form-control">
										<volist id="from" name="teamFrom">
											<option value="{$from.id}">{$from.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="from_id" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="from_id" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">处理结果：</p>
								<span id="team_result_show" class="col-sm-3" style="padding-left: 0; float: left; color: red;">{$team.team_result_type_desc}</span>
								<div id="team_result_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#team_result_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="team_result_val" class="form-control">
										<volist id="result" name="team_proc_result">
											<option value="{$result.id}">{$result.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="team_result" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="team_result" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">住宿酒店条件：</p>
								<span id="hotel_request_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.hotel_request_type_desc}</span>
								<div id="hotel_request_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#hotel_request_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="hotel_request_val" class="form-control">
										<volist id="hotel" name="hotel_request">
											<option value="{$hotel.id}">{$hotel.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="hotel_request" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="hotel_request" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">领队要求：</p>
								<span id="leader_request_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.leader_request_type_desc}</span>
								<div id="leader_request_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#leader_request_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="leader_request_val" class="form-control">
										<volist id="leader" name="leader_request">
											<option value="{$leader.id}">{$leader.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="leader_request" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="leader_request" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<!--<div class="row form-group">
								<p class="col-sm-1">车辆要求：</p>
								<span id="car_request_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.car_request_type_desc}</span>
								<div id="car_request_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#car_request_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="car_request_val" class="form-control">
										<volist id="car" name="car_request">
											<option value="{$car.id}">{$car.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="car_request" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="car_request" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>-->
							
							<div class="row form-group">
								<p class="col-sm-1">特色服务：</p>
								<span id="especial_request_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.especial_request_type_desc}</span>
								<div id="especial_request_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#especial_request_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="especial_request_val" class="form-control">
										<volist id="especial" name="especial_request">
											<option value="{$especial.id}">{$especial.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="especial_request" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="especial_request" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">联系时间：</p>
								<span id="contact_time_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.contact_time_type_desc}</span>
								<div id="contact_time_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#contact_time_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="contact_time_val" class="form-control">
										<volist id="contact" name="contact_time">
											<option value="{$contact.id}">{$contact.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="contact_time" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="contact_time" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">其他联系方式：</p>
								<span id="other_contact_show" class="col-sm-3" style="padding-left: 0;">{$team.other_contact}</span>
								<input type="text" id="other_contact_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true">
									<input type="button" name="other_contact" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="other_contact" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">其他需求：</p>
								<span id="other_request_show" class="col-sm-3" style="padding-left: 0;">{$team.other_request}</span>
								<textarea id="other_request_val" class="dingdan_bianji col-sm-8"></textarea>
								<if condition="$grant_update_team eq true">
									<input type="button" name="other_request" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="other_request" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">接手管理员：</p>
								<span class="col-sm-3" style="padding-left: 0;">{$team.dispose_admin_id_show_text}</span>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">包团状态：</p>
								<span class="col-sm-3" style="padding-left: 0;">{$team.dispose_state_id_type_desc}</span>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">行程标题：</p>
								<span id="title_show" class="col-sm-3" style="padding-left: 0;">{$team.title}</span>
								<input type="text" id="title_val" style="height: 32px;" class="dingdan_bianji col-sm-8">
								<if condition="$grant_update_team eq true or $grant_force_team eq true">
									<input type="button" name="title" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="title" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">成人价格：</p>
								<span id="price_adult_show" class="col-sm-3" style="padding-left: 0;">{$team.price_adult}</span>
								<input type="text" id="price_adult_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true or $grant_force_team eq true">
									<input type="button" name="price_adult" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="price_adult" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">小孩价格：</p>
								<span id="price_child_show" class="col-sm-3" style="padding-left: 0;">{$team.price_child}</span>
								<input type="text" id="price_child_val" style="height: 32px;" class="dingdan_bianji col-sm-3">
								<if condition="$grant_update_team eq true or $grant_force_team eq true">
									<input type="button" name="price_child" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="price_child" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">去程交通：</p>
								<span id="go_traffic_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.go_traffic_type_desc}</span>
								<div id="go_traffic_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#go_traffic_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="go_traffic_val" class="form-control">
										<volist id="traffic" name="traffic_tools">
											<option value="{$traffic.id}">{$traffic.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="go_traffic" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="go_traffic" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="row form-group">
								<p class="col-sm-1">回程交通：</p>
								<span id="back_traffic_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.back_traffic_type_desc}</span>
								<div id="back_traffic_container" class="input-group col-sm-3 dingdan_bianji" style="border-color: #40bbea; float: left;">
									<script type="text/javascript">
										jQuery(document).ready(function($)
										{
											$("#back_traffic_val").selectBoxIt().on('open', function()
											{
												// Adding Custom Scrollbar
												$(this).data('selectBoxSelectBoxIt').list.perfectScrollbar();
											});
										});
									</script>
									<select id="back_traffic_val" class="form-control">
										<volist id="traffic" name="traffic_tools">
											<option value="{$traffic.id}">{$traffic.type_desc}</option>
										</volist>
									</select>
								</div>
								<if condition="$grant_update_team eq true">
									<input type="button" name="back_traffic" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="back_traffic" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
													
							<div class="form-group row">
								<p class="cantuanrenshu col-sm-1">集合时间：</p>
								<span id="meet_time_show" class="col-sm-3" style="padding-left: 0; float: left;">{$team.meet_time}</span>	
								<div id="meet_time_container" class=" col-sm-3 dingdan_bianji date form_datetime" style="border-color: #40bbea; float: left;" data-date="" data-date-format="yyyy-mm-dd" data-link-field="meet_time_val">
								    <input id="meet_time_val" type="text" value="" readonly style="width:100%;" />
									<span class="add-on"><i class="icon-th"></i></span>
								</div>				
								<script type="text/javascript">
									$(document).ready(function(){
//									    $("#meet_time_container").datetimepicker({
									    $("#meet_time_container").datepicker({
									        language:  'zh-CN',
									        weekStart: 1,
									        todayBtn:  1,
											autoclose: 1,
											todayHighlight: 1,
											startView: 2,
											forceParse: 0,
									    });
									});
								</script>          
								<if condition="$grant_update_team eq true">
									<input type="button" name="meet_time" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="meet_time" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">	
								</if>					
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">集合地点：</p>
								<span id="meet_addr_show" class="col-sm-3" style="padding-left: 0;">{$team.meet_addr}</span>
								<input type="text" id="meet_addr_val" style="height: 32px;" class="dingdan_bianji col-sm-8">
								<if condition="$grant_update_team eq true">
									<input type="button" name="meet_addr" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="meet_addr" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>
							
							<div class="form-group row">
								<p class="col-sm-1">集合须知：</p>
								<span id="meet_intro_show" class="col-sm-3" style="padding-left: 0;">{$team.meet_intro}</span>
								<textarea id="meet_intro_val" class="dingdan_bianji col-sm-8"></textarea>
								<if condition="$grant_update_team eq true">
									<input type="button" name="meet_intro" class="btn btn-info btn_edit" style="vertical-align: middle;" value="编辑">
									<input type="button" name="meet_intro" class="btn btn-info btn_cancel" style="vertical-align: middle;" value="取消">
								</if>
							</div>	
							
							<!--跟进信息-->
							<div class="col-sm-12" style=" margin-top: 2%;">	
								<p class="text-danger lead">跟进信息：</p><br />
								
								<if condition="$grant_update_team eq true">
									<div class="row">					
										<label style="float:left;">内容：</label>
										<input id="team_message" type="text" class="col-sm-8" style="float:left;"/>&nbsp;&nbsp;
										<input id="btn_team_message" type="button" value="写入跟进"/>
									</div><br />
								</if>		

								<div class="row">
									<table id="table_message" class="table text-left" style="width: 80%;">
										<thead>
											<tr>
												<th class="col-sm-2">跟进账号</th>
												<th class="col-sm-2">跟进时间</th>
												<th class="col-sm-8">跟进内容</th>	
											</tr>
											<tbody>
												<volist id="msg" name="message">
													<tr>
														<td><span>{$msg.admin_id_account}</span></td>
														<td><span>{$msg.create_time}</span></td>
														<td><span>{$msg.content}</span></td>
													</tr>
												</volist>
											</tbody>
										</thead>
									</table>
								</div>
							</div>
							
						</div>
						
						<br />
						<br />
						<if condition="$grant_list_scheduling eq true">
							<button id="add_scheduling" class="btn btn-info">行程管理</button>
						</if>
						<if condition="$grant_update_team eq true">
							<button id="create_order" class="btn btn-warning">生成订单</button>
						</if>
						<if condition="empty($order) eq false">
							<a href="{:U('order/info')}/id/{$order.id}" class="btn btn-secondary" target="_blank">订单详细</a>
						</if>

						<button id="back_list" type="button" class="btn btn-secondary">返回列表</button>
					</div>
				</div>
			</div>
		</div>
	</div>
<include file="Common/footer" />
<script type="text/javascript">
	$(document).ready(function(){
		// 联系电话输入检测
		$('#tel_val').keyup(inputIntFloatCheck);
		
		// 检测电话是否正确
		$('#tel_val').blur(checkPhone);
		
		// 联系QQ输入检测
		$('#qq_val').keyup(inputIntFloatCheck);
		
		// 行程费用检测
		$('#price_adult_val').keyup(inputIntFloatCheck);
		$('#price_child_val').keyup(inputIntFloatCheck);

		// 添加跟踪记录
		$('#btn_team_message').click(appendOrderMessage);	
		
		// 添加行程
		$('#add_scheduling').click(addScheduling);
		
		// 生成订单
		$('#create_order').click(createTeamOrder);
		
		// 返回列表
		$('#back_list').click(function(){window.history.go(-1);});
		
		// 编辑数据
		$('.btn_edit').click(saveData);
		
		// 取消数据
		$('.btn_cancel').click(function(){
			showEditTags($(this).parent(), $(this).attr('name'));
		});
	});

	// 检测申请费用
	function inputIntFloatCheck() {
		var val = $(this).val();
	    if('' != val.replace(/\d{1,}\.{0,1}\d{0,}/,''))
	    {
	        var str = val.match(/\d{1,}\.{0,1}\d{0,}/) == null ? '' : val.match(/\d{1,}\.{0,1}\d{0,}/);
	        $(this).val(str);
	    }
	}
	
	// 检测电话号码
	function checkPhone() {
		var val = $(this).val();
		if (checkMobile(val) == false && checkTel(val) == false) {
			alert('手机或者号码格式有误，您确定继续添加');
			return false;
		}
	}
	
	// 添加订单留言
	function ajaxAppendOrderMessage(content) {
		var jsonData = {
			'op_type': 'save_message',
			'team_id': $('#team_id').val(),	
			'content': content,
		}; 

		

		var result = false;
		$.ajaxSetup({async:false});
		$.post('{:U("team/info")}', jsonData, function(data){
			if (data.result.errno == 0) {
				var s = data['message'];
				var html = '';
					html += '<tr>';
					html += '	<td><span>'+s['admin_id_account']+'</span></td>';
					html += '	<td><span>'+s['create_time']+'</span></td>';
					html += '	<td><span>'+s['content']+'</span></td>';
					html += '</tr>';
				$('#table_message').find('tbody').prepend(html);
				result = true;
			} else {
				alert(data.result.message);
			}
		});
		return result;
	}

	// 添加跟踪记录
	function appendOrderMessage() {
		var content = $('#team_message').val();
		if (content == '') {
			alert('跟进信息不能为空');
			return false;
		}	

		if (ajaxAppendOrderMessage(content)) {
			$('#team_message').val('');
		}
	}
	
	// 添加行程
	function addScheduling() {
		var teamId = $('#team_id').val();
		if (teamId == '' || teamId == 0) {
			alert('错误的包团编号，不能添加行程');
			return false;
		}	
		
		$.getJSON('{:U("team/scheduling")}', {op:'info_url', id:teamId}, function(data){
			if (data.result.errno == 0) {
				location.href = data.jumpUrl;
			} else {
				alert(data.result.message);
			}
		});
	}
	
	// 生成团队订单
	function createTeamOrder() {
		var teamId = $('#team_id').val();
		if (teamId == '' || teamId == 0) {
			alert('错误的包团编号，不能生成订单');
			return false;
		}	
		
		var w = window.open();
		$.post('{:U("team/order")}', {op:'jump_order', id:teamId}, function(data){
			if (data.jumpUrl != null) {
				w.location = data.jumpUrl;	
			} else {
				w.close();
			}
			
			if (data.result != null && data.result.errno != 0) {
				alert(data.result.message);
			}
		});
	}
	
	function showEditTags(divObj, namestr, bFail) {
		var editVal = $(divObj).find('.btn_edit').val();		
		var containerObj = $(divObj).find('#'+namestr+'_container');
		var showObj = $(divObj).find('#'+namestr+'_show');
		var valObj = $(divObj).find('#'+namestr+'_val');
		var showHtmlObj = $(containerObj).length > 0 ? containerObj : valObj;
		if (editVal == '编辑') {
			var dataText = $(showObj).html();
			var tagHtml = $(valObj).get(0).tagName;
			if (tagHtml == 'INPUT') {
				$(valObj).val(dataText);
			} else if (tagHtml == 'SELECT') {
				$(valObj).val('11').trigger('change');
			} else if (tagHtml == 'TEXTAREA') {
				$(valObj).html(dataText);
			}
			
			$(showObj).hide();
			$(showHtmlObj).show();
			
			$(divObj).find('.btn_edit').val('保存');
			$(divObj).find('.btn_cancel').show();
		} else {
			
			$(showObj).show();
			$(showHtmlObj).hide();
			
			$(divObj).find('.btn_edit').val('编辑');
			$(divObj).find('.btn_cancel').hide();
		}
	}
	
	function saveData() {
		var divObj = $(this).parent();
		var namestr = $(this).attr('name');
		
		var editVal = $(divObj).find('.btn_edit').val();
		if (editVal == '编辑') {
			showEditTags(divObj, namestr);
			return false;
		}		
		
		var showObj = $(divObj).find('#'+namestr+'_show');
		var valObj = $(divObj).find('#'+namestr+'_val');
		
		
		var showText = ''
		var modifyData = '';
		var tagName = $(valObj).get(0).tagName;
		if (tagName == 'SELECT') {
			showText = $(divObj).find('#'+namestr+'_valSelectBoxItText').html();
			modifyData = $(valObj).val();
		} else {
			modifyData = $(valObj).val();
			showText = modifyData;
		}
		
		if (modifyData == '') {
			showEditTags(divObj, namestr);
			alert('修改数据不能为空');
			return false;
		}
		
		var teamId = $('#team_id').val();
		var jsonData = {
			op_type: 'edit',
			cds:[
				{name:'id', value:teamId},
			],
			data: [
				{name:namestr, value:modifyData},
			]
		}
		
		console.log(JSON.stringify(jsonData));
		
		$.post('{:U("team/info")}', jsonData, function(data){
			if (data.result.errno != 0) {
				alert(data.result.message);
			} else {				
				$(showObj).html(showText);
			}
			showEditTags(divObj, namestr);
		});	
	}
</script>